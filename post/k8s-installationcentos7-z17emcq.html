<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Wh1teJ0kerのBlog</title>
<meta charset=utf-8><meta name=description content="Ladder@K8s安装-Centos7
环境与配置文件
K8S_master

1处理器4核
4G内存
40G硬盘

K8S_node1
K8S_node2
Vmware虚拟机设置安装
Centos7安装
使用镜像如下：CentOS-7-x86_64-Minimal-2009.iso
首先先完成虚拟机的安装，基本是默认设置即可"><meta name=author content="Wh1teJ0ker"><link rel=canonical href=https://wh1tej0ker.github.io/post/k8s-installationcentos7-z17emcq.html><link rel=alternate type=application/rss+xml href=https://wh1tej0ker.github.io//index.xml title=Wh1teJ0kerのBlog><script async defer data-website-id=56cc42c1-3656-4d3e-af3c-acded927b8ed src=https://analytics.umami.is/script.js></script><meta property="og:url" content="https://wh1tej0ker.github.io/post/k8s-installationcentos7-z17emcq.html"><meta property="og:site_name" content="Wh1teJ0kerのBlog"><meta property="og:title" content="K8s安装-Centos7"><meta property="og:description" content="K8s安装-Centos7 环境与配置文件 K8S_master
1处理器4核 4G内存 40G硬盘 K8S_node1
K8S_node2
Vmware虚拟机设置安装 Centos7安装 使用镜像如下：CentOS-7-x86_64-Minimal-2009.iso
首先先完成虚拟机的安装，基本是默认设置即可"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-08-28T08:36:16+08:00"><meta property="article:modified_time" content="2025-04-06T14:16:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="K8s安装-Centos7"><meta name=twitter:description content="K8s安装-Centos7 环境与配置文件 K8S_master
1处理器4核 4G内存 40G硬盘 K8S_node1
K8S_node2
Vmware虚拟机设置安装 Centos7安装 使用镜像如下：CentOS-7-x86_64-Minimal-2009.iso
首先先完成虚拟机的安装，基本是默认设置即可"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wh1tej0ker.github.io/post/"},{"@type":"ListItem","position":2,"name":"K8s安装-Centos7","item":"https://wh1tej0ker.github.io/post/k8s-installationcentos7-z17emcq.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"K8s安装-Centos7","name":"K8s安装-Centos7","description":"K8s安装-Centos7 环境与配置文件 K8S_master\n1处理器4核 4G内存 40G硬盘 K8S_node1\nK8S_node2\nVmware虚拟机设置安装 Centos7安装 使用镜像如下：CentOS-7-x86_64-Minimal-2009.iso\n首先先完成虚拟机的安装，基本是默认设置即可\n","keywords":[],"articleBody":"K8s安装-Centos7 环境与配置文件 K8S_master\n1处理器4核 4G内存 40G硬盘 K8S_node1\nK8S_node2\nVmware虚拟机设置安装 Centos7安装 使用镜像如下：CentOS-7-x86_64-Minimal-2009.iso\n首先先完成虚拟机的安装，基本是默认设置即可\n唯一注意需要添加root账户的密码！\n​​\n配置网络 1 2 3 4 $ vi /etc/sysconfig/network # 添加下面的配置 NETWORKING=yes HOSTNAME=master 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 $ vi /etc/sysconfig/network-scripts/ifcfg-ens33 # 配置如下 TYPE=Ethernet PROXY_METHOD=none BROWSER_ONLY=no -BOOTPROTO=dchp +BOOTPROTO=static DEFROUTE=yes IPV4_FAILURE_FATAL=no IPV6INIT=yes IPV6_AUTOCONF=yes IPV6_DEFROUTE=yes IPV6_FAILURE_FATAL=no IPV6_ADDR_GEN_MODE=stable-privacy -UUID=XXXX-XXXX-XXXX -ONBOOT=no +ONBOOT=yes IPADDR=192.168.188.180 NETMASK=255.255.255.0 GATEWAY=192.168.188.2 NAME=ens33 DEVICE=ens33 #DNS1采用本地网关，DNS2使用公共DNS DNS1=192.168.188.2 DNS2=114.114.114.114 配置hosts\n1 2 3 4 5 6 7 $ vi /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 #根据上述查看的NAT分配IP进行调整 192.168.188.180 master 192.168.188.181 node1 192.168.188.182 node2 完成上述后，进行reboot并且进行ping确认是否能够联网\nCentOS7安装VMware Tools_yun安装vmtools-CSDN博客\n00:0c:29:84:5a:b4\n系统配置 关闭防火墙\n1 2 $ service iptables stop $ systemctl disable iptables 若无，则会报错\n1 2 3 4 5 [root@master ~]# service iptables stop Redirecting to /bin/systemctl stop iptables.service Failed to stop iptables.service: Unit iptables.service not loaded. [root@master ~]# systemctl disable iptables Failed to execute operation: No such file or directory 禁用selinux\n1 2 3 4 5 6 7 8 # 查看selinux $ getenforce Enforcing # 关闭 $ vi /etc/selinux/config # 修改为：disabled SELINUX=disabled 禁用防火墙\n1 2 systemctl stop firewalld systemctl disable firewalld SSH登录配置 1 2 3 4 5 6 $ vi /etc/ssh/sshd_config # 修改 UseDNS no PermitRootLogin yes #允许root登录 PermitEmptyPasswords no #不允许空密码登录 PasswordAuthentication yes # 设置是否使用口令验证 440\n4关闭Swap空间 1 2 3 4 5 6 [root@master ~]# swapoff -a [root@master ~]# sed -ie '/swap/ s/^/# /' /etc/fstab [root@master ~]# free -m total used free shared buff/cache available Mem: 3770 1265 1304 12 1200 2267 Swap: 0 0 0 配置桥接流量 1 2 3 4 [root@k8s-master1 ~]# cat \u003e /etc/sysctl.d/k8s.conf \u003c\u003c EOF net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF 配置yum源 1 2 3 4 5 6 7 8 9 10 11 12 # 配置阿里云源 # 备份 mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup # 配置 curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo # 生成缓存 yum makecache # 安装epel库 yum -y install epel-release yum -y update 基本软件配置 1 2 yum install -y wget yum install -y htop vim net-tools wget 时间同步ntp 1 yum install ntp 配置ntp：\n1 2 3 4 5 # 开启服务 service ntpd start # 开机启动 systemctl enable ntpd Docker 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 yum install -y yum-utils device-mapper-persistent-data lvm2 yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo sed -i 's+download.docker.com+mirrors.aliyun.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo # 更新源 yum makecache fast #查看所有版本 yum list docker-ce --showduplicates | sort -r #安装指定版本 yum -y install docker-ce-19.03.9 yum install -y docker-ce-19.03.9 docker-ce-cli-19.03.9 containerd.io #设置开机自启动 systemctl enable docker \u0026\u0026 systemctl start docker #配置镜像源 cat \u003e /etc/docker/daemon.json \u003c\u003c EOF { \"exec-opts\": [“native.cgroupdriver=systemd”], \"registry-mirrors\" : [ \"http://hub-mirror.c.163.com\", \"http://registry.docker-cn.com\", \"http://docker.mirrors.ustc.edu.cn\" ] } EOF vi /etc/docker/daemon.json #重启docker systemctl restart docker docker info | grep 'Server Version' 安装kubeadm/kubelet和kubectl 安装需要注意两问题，一个是安装的版本要统一，一个是安装的版本不要太新\n1 2 3 4 5 6 7 8 9 cat \u003e /etc/yum.repos.d/kubernetes.repo \u003c","wordCount":"2761","inLanguage":"en","datePublished":"2024-08-28T08:36:16+08:00","dateModified":"2025-04-06T14:16:35+08:00","author":{"@type":"Person","name":"Wh1teJ0ker"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wh1tej0ker.github.io/post/k8s-installationcentos7-z17emcq.html"},"publisher":{"@type":"Organization","name":"Wh1teJ0kerのBlog","logo":{"@type":"ImageObject","url":"https://wh1tej0ker.github.io/favicon.ico"}}}</script><link rel=icon type=image/png href=/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/favicon.ico><link rel=manifest href=/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.9d998bab4720091d5ec1e0fbbffd92b254a2e791623df6106cd7ea760bfc5c28.css integrity="sha256-nZmLq0cgCR1eweD7v/2SslSi55FiPfYQbNfqdgv8XCg=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/categories/>分类</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives/>归档</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/friends/>友链</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/about/>关于</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=https://cloud.umami.is/share/5RZUCwaG2fOysYPa/wh1tej0ker.github.io>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/Wh1teJ0ker><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>K8s安装-Centos7</h1></header><p><small>August 28, 2024&nbsp;· &nbsp;·</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#centos7安装>Centos7安装</a></li><li><a href=#配置网络>配置网络</a></li><li><a href=#系统配置>系统配置</a></li><li><a href=#ssh登录配置>SSH登录配置</a></li><li><a href=#4关闭swap空间>4关闭Swap空间</a></li><li><a href=#配置桥接流量>配置桥接流量</a></li><li><a href=#配置yum源>配置yum源</a></li><li><a href=#基本软件配置>基本软件配置</a><ul><li><a href=#时间同步ntp>时间同步ntp</a></li><li><a href=#docker>Docker</a></li><li><a href=#安装kubeadmkubelet和kubectl>安装kubeadm/kubelet和kubectl</a></li></ul></li><li><a href=#快照克隆>快照克隆</a></li><li><a href=#修改克隆机及测试>修改克隆机及测试</a></li></ul><ul><li><a href=#初始化master>初始化master</a></li><li><a href=#拷贝认证文件>拷贝认证文件</a></li><li><a href=#安装calico>安装Calico</a></li></ul><ul><li><a href=#下载部署>下载部署</a></li><li><a href=#证书修改方法存疑保留>证书修改（方法存疑）（保留）</a><ul><li><a href=#删除默认的secret>删除默认的secret</a></li><li><a href=#签发证书>签发证书</a></li><li><a href=#创建启用secret>创建启用secret</a></li><li><a href=#创建用户角色>创建用户角色</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=k8s安装-centos7>K8s安装-Centos7</h1><h1 id=环境与配置文件>环境与配置文件</h1><p><strong>K8S_master</strong></p><ul><li>1处理器4核</li><li>4G内存</li><li>40G硬盘</li></ul><p><strong>K8S_node1</strong></p><p><strong>K8S_node2</strong></p><h1 id=vmware虚拟机设置安装>Vmware虚拟机设置安装</h1><h2 id=centos7安装>Centos7安装</h2><p>使用镜像如下：CentOS-7-x86_64-Minimal-2009.iso</p><p>首先先完成虚拟机的安装，基本是默认设置即可</p><p>唯一注意需要添加root账户的密码！</p><p>​<img src=https://cdn.nlark.com/yuque/0/2024/png/42600779/1717074028087-41e79e38-097f-4885-a26a-80b32eedd407.png alt>​</p><h2 id=配置网络>配置网络</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>$ vi /etc/sysconfig/network
</span></span><span class=line><span class=cl># 添加下面的配置
</span></span><span class=line><span class=cl>NETWORKING=yes
</span></span><span class=line><span class=cl>HOSTNAME=master
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>$ vi /etc/sysconfig/network-scripts/ifcfg-ens33
</span></span><span class=line><span class=cl># 配置如下
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TYPE=Ethernet
</span></span><span class=line><span class=cl>PROXY_METHOD=none
</span></span><span class=line><span class=cl>BROWSER_ONLY=no
</span></span><span class=line><span class=cl>-BOOTPROTO=dchp
</span></span><span class=line><span class=cl>+BOOTPROTO=static
</span></span><span class=line><span class=cl>DEFROUTE=yes
</span></span><span class=line><span class=cl>IPV4_FAILURE_FATAL=no
</span></span><span class=line><span class=cl>IPV6INIT=yes
</span></span><span class=line><span class=cl>IPV6_AUTOCONF=yes
</span></span><span class=line><span class=cl>IPV6_DEFROUTE=yes
</span></span><span class=line><span class=cl>IPV6_FAILURE_FATAL=no
</span></span><span class=line><span class=cl>IPV6_ADDR_GEN_MODE=stable-privacy
</span></span><span class=line><span class=cl>-UUID=XXXX-XXXX-XXXX
</span></span><span class=line><span class=cl>-ONBOOT=no
</span></span><span class=line><span class=cl>+ONBOOT=yes
</span></span><span class=line><span class=cl>IPADDR=192.168.188.180  
</span></span><span class=line><span class=cl>NETMASK=255.255.255.0
</span></span><span class=line><span class=cl>GATEWAY=192.168.188.2   
</span></span><span class=line><span class=cl>NAME=ens33
</span></span><span class=line><span class=cl>DEVICE=ens33
</span></span><span class=line><span class=cl>#DNS1采用本地网关，DNS2使用公共DNS
</span></span><span class=line><span class=cl>DNS1=192.168.188.2  
</span></span><span class=line><span class=cl>DNS2=114.114.114.114
</span></span></code></pre></td></tr></table></div></div><p>配置hosts</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>$ vi /etc/hosts
</span></span><span class=line><span class=cl>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span class=line><span class=cl>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span class=line><span class=cl>#根据上述查看的NAT分配IP进行调整
</span></span><span class=line><span class=cl>192.168.188.180 master
</span></span><span class=line><span class=cl>192.168.188.181 node1
</span></span><span class=line><span class=cl>192.168.188.182 node2
</span></span></code></pre></td></tr></table></div></div><p>完成上述后，进行reboot并且进行ping确认是否能够联网</p><p><a href=https://blog.csdn.net/zhujing16/article/details/88677253>CentOS7安装VMware Tools_yun安装vmtools-CSDN博客</a></p><p>00:0c:29:84:5a:b4</p><h2 id=系统配置>系统配置</h2><p><strong>关闭防火墙</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>$ service iptables stop
</span></span><span class=line><span class=cl>$ systemctl disable iptables
</span></span></code></pre></td></tr></table></div></div><p>若无，则会报错</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>  [root@master ~]# service iptables stop
</span></span><span class=line><span class=cl>  Redirecting to /bin/systemctl stop iptables.service
</span></span><span class=line><span class=cl>  Failed to stop iptables.service: Unit iptables.service not loaded.
</span></span><span class=line><span class=cl>  [root@master ~]# systemctl disable iptables
</span></span><span class=line><span class=cl>  Failed to execute operation: No such file or directory
</span></span></code></pre></td></tr></table></div></div><p><strong>禁用selinux</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl># 查看selinux
</span></span><span class=line><span class=cl>$ getenforce
</span></span><span class=line><span class=cl>Enforcing
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 关闭
</span></span><span class=line><span class=cl>$ vi /etc/selinux/config
</span></span><span class=line><span class=cl># 修改为：disabled
</span></span><span class=line><span class=cl>SELINUX=disabled
</span></span></code></pre></td></tr></table></div></div><p><strong>禁用防火墙</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>systemctl stop firewalld
</span></span><span class=line><span class=cl>systemctl disable firewalld
</span></span></code></pre></td></tr></table></div></div><h2 id=ssh登录配置>SSH登录配置</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>$ vi /etc/ssh/sshd_config
</span></span><span class=line><span class=cl># 修改
</span></span><span class=line><span class=cl>UseDNS no
</span></span><span class=line><span class=cl>PermitRootLogin yes #允许root登录
</span></span><span class=line><span class=cl>PermitEmptyPasswords no #不允许空密码登录
</span></span><span class=line><span class=cl>PasswordAuthentication yes # 设置是否使用口令验证
</span></span></code></pre></td></tr></table></div></div><p>440</p><h2 id=4关闭swap空间>4关闭Swap空间</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>[root@master ~]# swapoff -a
</span></span><span class=line><span class=cl>[root@master ~]# sed -ie &#39;/swap/ s/^/# /&#39; /etc/fstab 
</span></span><span class=line><span class=cl>[root@master ~]# free -m
</span></span><span class=line><span class=cl>              total        used        free      shared  buff/cache   available
</span></span><span class=line><span class=cl>Mem:           3770        1265        1304          12        1200        2267
</span></span><span class=line><span class=cl>Swap:             0           0           0
</span></span></code></pre></td></tr></table></div></div><h2 id=配置桥接流量>配置桥接流量</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>[root@k8s-master1 ~]# cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF
</span></span><span class=line><span class=cl>net.bridge.bridge-nf-call-ip6tables = 1
</span></span><span class=line><span class=cl>net.bridge.bridge-nf-call-iptables = 1
</span></span><span class=line><span class=cl>EOF
</span></span></code></pre></td></tr></table></div></div><h2 id=配置yum源>配置yum源</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl># 配置阿里云源
</span></span><span class=line><span class=cl># 备份
</span></span><span class=line><span class=cl>mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
</span></span><span class=line><span class=cl># 配置
</span></span><span class=line><span class=cl>curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span class=line><span class=cl>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span class=line><span class=cl># 生成缓存
</span></span><span class=line><span class=cl>yum makecache
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 安装epel库
</span></span><span class=line><span class=cl>yum -y install epel-release
</span></span><span class=line><span class=cl>yum -y update
</span></span></code></pre></td></tr></table></div></div><h2 id=基本软件配置>基本软件配置</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>yum install -y wget
</span></span><span class=line><span class=cl>yum install -y htop vim net-tools wget
</span></span></code></pre></td></tr></table></div></div><h3 id=时间同步ntp>时间同步ntp</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>yum install ntp
</span></span></code></pre></td></tr></table></div></div><p>配置ntp：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl># 开启服务
</span></span><span class=line><span class=cl>service ntpd start
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 开机启动
</span></span><span class=line><span class=cl>systemctl enable ntpd
</span></span></code></pre></td></tr></table></div></div><h3 id=docker>Docker</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>yum install -y yum-utils device-mapper-persistent-data lvm2
</span></span><span class=line><span class=cl>yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span class=line><span class=cl>sed -i &#39;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#39; /etc/yum.repos.d/docker-ce.repo
</span></span><span class=line><span class=cl># 更新源
</span></span><span class=line><span class=cl>yum makecache fast
</span></span><span class=line><span class=cl>#查看所有版本
</span></span><span class=line><span class=cl>yum list docker-ce --showduplicates | sort -r
</span></span><span class=line><span class=cl>#安装指定版本
</span></span><span class=line><span class=cl>yum -y install docker-ce-19.03.9
</span></span><span class=line><span class=cl>yum install -y docker-ce-19.03.9 docker-ce-cli-19.03.9 containerd.io
</span></span><span class=line><span class=cl>#设置开机自启动
</span></span><span class=line><span class=cl>systemctl enable docker &amp;&amp; systemctl start docker
</span></span><span class=line><span class=cl>#配置镜像源
</span></span><span class=line><span class=cl>cat &gt; /etc/docker/daemon.json &lt;&lt; EOF
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;exec-opts&#34;: [“native.cgroupdriver=systemd”],
</span></span><span class=line><span class=cl>  &#34;registry-mirrors&#34; : [
</span></span><span class=line><span class=cl>    &#34;http://hub-mirror.c.163.com&#34;,
</span></span><span class=line><span class=cl>    &#34;http://registry.docker-cn.com&#34;,
</span></span><span class=line><span class=cl>    &#34;http://docker.mirrors.ustc.edu.cn&#34;
</span></span><span class=line><span class=cl>  ]
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>EOF
</span></span><span class=line><span class=cl>vi /etc/docker/daemon.json
</span></span><span class=line><span class=cl>#重启docker
</span></span><span class=line><span class=cl>systemctl restart docker
</span></span><span class=line><span class=cl>docker info | grep &#39;Server Version&#39;
</span></span></code></pre></td></tr></table></div></div><h3 id=安装kubeadmkubelet和kubectl>安装kubeadm/kubelet和kubectl</h3><p>安装需要注意两问题，一个是安装的版本要统一，一个是安装的版本不要太新</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>cat  &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt;EOF
</span></span><span class=line><span class=cl>[kubernetes]
</span></span><span class=line><span class=cl>name=Kubernetes
</span></span><span class=line><span class=cl>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
</span></span><span class=line><span class=cl>enabled=1
</span></span><span class=line><span class=cl>gpgcheck=1
</span></span><span class=line><span class=cl>repo_gpgcheck=1
</span></span><span class=line><span class=cl>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span><span class=line><span class=cl>EOF
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>yum install kubeadm-1.20.2 -y
</span></span><span class=line><span class=cl>yum install -y kubelet-1.20.4 kubectl-1.20.4 kubeadm-1.20.4
</span></span><span class=line><span class=cl>systemctl enable kubelet
</span></span><span class=line><span class=cl>kubectl version
</span></span><span class=line><span class=cl>kubeadm version
</span></span><span class=line><span class=cl>kubelet version
</span></span></code></pre></td></tr></table></div></div><h2 id=快照克隆>快照克隆</h2><p>在master机器保持静止的状态下使用克隆功能，进行复制，创建node1和node2</p><h2 id=修改克隆机及测试>修改克隆机及测试</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>$ vi /etc/sysconfig/network
</span></span><span class=line><span class=cl>NETWORKING=yes
</span></span><span class=line><span class=cl>HOSTNAME=master
</span></span><span class=line><span class=cl>HOSTNAME=node1
</span></span><span class=line><span class=cl>HOSTNAME=node2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ vi /etc/sysconfig/network-scripts/ifcfg-ens33
</span></span><span class=line><span class=cl>TYPE=Ethernet
</span></span><span class=line><span class=cl>PROXY_METHOD=none
</span></span><span class=line><span class=cl>BROWSER_ONLY=no
</span></span><span class=line><span class=cl>BOOTPROTO=static
</span></span><span class=line><span class=cl>DEFROUTE=yes
</span></span><span class=line><span class=cl>IPV4_FAILURE_FATAL=no
</span></span><span class=line><span class=cl>IPV6INIT=yes
</span></span><span class=line><span class=cl>IPV6_AUTOCONF=yes
</span></span><span class=line><span class=cl>IPV6_DEFROUTE=yes
</span></span><span class=line><span class=cl>IPV6_FAILURE_FATAL=no
</span></span><span class=line><span class=cl>IPV6_ADDR_GEN_MODE=stable-privacy
</span></span><span class=line><span class=cl>- IPADDR=192.168.188.180
</span></span><span class=line><span class=cl>+ IPADDR=192.168.188.181
</span></span><span class=line><span class=cl>NETMASK=255.255.255.0
</span></span><span class=line><span class=cl>GATEWAY=192.168.188.2
</span></span><span class=line><span class=cl>NAME=ens33
</span></span><span class=line><span class=cl>DEVICE=ens33
</span></span><span class=line><span class=cl>ONBOOT=yes
</span></span><span class=line><span class=cl>DNS1=192.168.188.2
</span></span><span class=line><span class=cl>DNS2=114.114.114.114
</span></span></code></pre></td></tr></table></div></div><p>使用ping分别对node1和ndoe2进行测试</p><h1 id=创建kubernetes集群>创建Kubernetes集群</h1><h2 id=初始化master>初始化master</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>[root@master ~]# kubeadm init \
</span></span><span class=line><span class=cl>  --apiserver-advertise-address=192.168.188.180 \
</span></span><span class=line><span class=cl>  --image-repository registry.aliyuncs.com/google_containers \
</span></span><span class=line><span class=cl>  --kubernetes-version v1.28.2 \
</span></span><span class=line><span class=cl>  --service-cidr=10.96.0.0/12 \
</span></span><span class=line><span class=cl>  --pod-network-cidr=10.244.0.0/16 \
</span></span><span class=line><span class=cl>  --ignore-preflight-errors=all
</span></span><span class=line><span class=cl>  sudo kubeadm init --apiserver-advertise-address=192.168.188.180 --image-repository registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --kubernetes-version=v1.20.4  --ignore-preflight-errors=all
</span></span></code></pre></td></tr></table></div></div><p>配置文件同上</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>  $ vi kubeadm.conf
</span></span><span class=line><span class=cl>  apiVersion: kubeadm.k8s.io/v1beta2
</span></span><span class=line><span class=cl>  kind: ClusterConfiguration
</span></span><span class=line><span class=cl>  kubernetesVersion: v1.28.2
</span></span><span class=line><span class=cl>  imageRepository: registry.aliyuncs.com/google_containers 
</span></span><span class=line><span class=cl>  networking:
</span></span><span class=line><span class=cl>    podSubnet: 10.244.0.0/16 
</span></span><span class=line><span class=cl>    serviceSubnet: 10.96.0.0/12 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  $ kubeadm init --config kubeadm.conf --ignore-preflight-errors=all
</span></span></code></pre></td></tr></table></div></div><p><strong>问题</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>vim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[Service]
</span></span><span class=line><span class=cl>Environment=&#34;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&#34;
</span></span><span class=line><span class=cl>Environment=&#34;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&#34;
</span></span><span class=line><span class=cl>EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env
</span></span><span class=line><span class=cl># This is a file that the user can use for overrides of the kubelet args as a last resort. 
</span></span><span class=line><span class=cl>EnvironmentFile=-/etc/default/kubelet
</span></span><span class=line><span class=cl>ExecStart=
</span></span><span class=line><span class=cl>ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
</span></span></code></pre></td></tr></table></div></div><h2 id=拷贝认证文件>拷贝认证文件</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl># 拷贝kubectl使用的连接k8s认证文件到默认路径
</span></span><span class=line><span class=cl>mkdir -p $HOME/.kube
</span></span><span class=line><span class=cl>cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span class=line><span class=cl>chown $(id -u):$(id -g) $HOME/.kube/config
</span></span></code></pre></td></tr></table></div></div><h2 id=安装calico>安装Calico</h2><p>这里又卡了好一会儿，是需要又对应的k8s和calico的版本要求</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>curl https://docs.projectcalico.org/v3.20/manifests/calico.yaml -O
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl apply -f calico.yaml
</span></span></code></pre></td></tr></table></div></div><p><strong>检测</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl get pods -n kube-system
</span></span><span class=line><span class=cl>kubectl get nodes
</span></span></code></pre></td></tr></table></div></div><p><strong>创建鉴权token</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubeadm token create --print-join-command
</span></span><span class=line><span class=cl>kubeadm join 192.168.188.180:6443 --token w928sh.9zjwu8hlfy12y3x6     --discovery-token-ca-cert-hash sha256:da708b8f6be1ed027ecc3910e3d13174fe8f608c3460d84c929fece921ed0597
</span></span></code></pre></td></tr></table></div></div><p>如果出现服务未启动，先尝试重启再去查找问题，可能是镜像不适配</p><h1 id=部署webuidashboard>部署WebUI（Dashboard）</h1><h2 id=下载部署>下载部署</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.1.0/aio/deploy/recommended.yaml -O dashboard.yaml
</span></span><span class=line><span class=cl>wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml -O dashboard.yaml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>vi dashboard.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: kubernetes-dashboard
</span></span><span class=line><span class=cl>  name: kubernetes-dashboard
</span></span><span class=line><span class=cl>  namespace: kubernetes-dashboard
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>+ type: NodePort
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>    - port: 443
</span></span><span class=line><span class=cl>      targetPort: 8443
</span></span><span class=line><span class=cl>+     nodePort: 30001
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    k8s-app: kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><p>配置文件应用即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl apply -f recommended.yaml
</span></span></code></pre></td></tr></table></div></div><p>确认服务启用后running以及是否TYPE修改成功</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl get pods -n kubernetes-dashboard
</span></span><span class=line><span class=cl>kubectl get svc -n kubernetes-dashboard
</span></span><span class=line><span class=cl>kubectl get all -n kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><h2 id=证书修改方法存疑保留>证书修改（方法存疑）（保留）</h2><h3 id=删除默认的secret>删除默认的secret</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl delete secret -n kubernetes-dashboard kubernetes-dashboard-certs
</span></span></code></pre></td></tr></table></div></div><h3 id=签发证书>签发证书</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>mkdir keys &amp; cd keys
</span></span><span class=line><span class=cl>openssl genrsa -out tls.key 2048
</span></span><span class=line><span class=cl>openssl req -new -out tls.csr -key tls.key -subj &#39;/CN=192.168.188.180&#39;
</span></span><span class=line><span class=cl>openssl x509 -req -in tls.csr -signkey tls.key -out tls.crt
</span></span><span class=line><span class=cl>ls
</span></span><span class=line><span class=cl>&gt;tls.crt tls.csr tls.key
</span></span></code></pre></td></tr></table></div></div><h3 id=创建启用secret>创建启用secret</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>cd keys # 如果本身就在keys文件夹下，则可以省略该步骤
</span></span><span class=line><span class=cl>kubectl create secret generic kubernetes-dashboard-certs --from-file=./ -n kubernetes-dashboard
</span></span><span class=line><span class=cl>kubectl edit deploy kubernetes-dashboard -n kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><h3 id=创建用户角色>创建用户角色</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl create serviceaccount dashboard-admin -n kube-system
</span></span><span class=line><span class=cl>kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin
</span></span><span class=line><span class=cl>kubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk &#39;/dashboard-admin/{print $1}&#39;)
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>#用户信息
</span></span><span class=line><span class=cl>Name:         dashboard-admin-token-2pnkj
</span></span><span class=line><span class=cl>Namespace:    kube-system
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  kubernetes.io/service-account.name: dashboard-admin
</span></span><span class=line><span class=cl>              kubernetes.io/service-account.uid: c872295c-3483-4558-a96e-6161cf9f84cb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type:  kubernetes.io/service-account-token
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Data
</span></span><span class=line><span class=cl>====
</span></span><span class=line><span class=cl>ca.crt:     1066 bytes
</span></span><span class=line><span class=cl>namespace:  11 bytes
</span></span><span class=line><span class=cl>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6Im5GbG83eUp0TThGeDNySHBUZ2pqSVE3UFg2empBYm1rbnFvVkVaYV8tVUEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tMnBua2oiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYzg3MjI5NWMtMzQ4My00NTU4LWE5NmUtNjE2MWNmOWY4NGNiIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.WbaC6TYCnUvfg-N3EbZ6Um-jl78tU_KRLorYUtGG7_ZSR7of_z6cJTDjd4U87OKeNlmNRqEXQkEEx3JZMMiEB6UzCF7QrLN0hOhtKtlarL-xd3HVwuiK_9m8GYtKtvB7wMvrmX4VUNeib11QhMiNDbvYdZc6JdqsEiqdP5bq3_iVsrWFFj5g6B5Z-ZvhdeHRE9Yy9KNBXdItqjLCot5Azv7GXn58WP6E8sZ3zM52J5J5dE8fcArHTptY6kxn0L7qHnzUd2pzqiTWVNBAtGYw-FH42feMFG0dMPsI4o0QqVswxQlp0dZ5YQlmfFn5J1EPEo__-LFbA5sipHk_dKKmow
</span></span></code></pre></td></tr></table></div></div><p>至此，k8s已经安装成功，中途大大小小的坑点真多，emmm</p><h1 id=安装metrics-server>安装metrics-server</h1><p>又碰到了一个小问题，这里主要是解决的无法查看cpu和内存的运行情况</p><p>需要安装一个新东西</p><p>修改相关yaml内容</p><ol><li>args增加参数：- –kubelet-insecure-tls #表示不验证客户端证书</li><li>image改为阿里镜像：registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: ServiceAccount
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRole
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>    rbac.authorization.k8s.io/aggregate-to-admin: &#34;true&#34;
</span></span><span class=line><span class=cl>    rbac.authorization.k8s.io/aggregate-to-edit: &#34;true&#34;
</span></span><span class=line><span class=cl>    rbac.authorization.k8s.io/aggregate-to-view: &#34;true&#34;
</span></span><span class=line><span class=cl>  name: system:aggregated-metrics-reader
</span></span><span class=line><span class=cl>rules:
</span></span><span class=line><span class=cl>- apiGroups:
</span></span><span class=line><span class=cl>  - metrics.k8s.io
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>  - pods
</span></span><span class=line><span class=cl>  - nodes
</span></span><span class=line><span class=cl>  verbs:
</span></span><span class=line><span class=cl>  - get
</span></span><span class=line><span class=cl>  - list
</span></span><span class=line><span class=cl>  - watch
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRole
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: system:metrics-server
</span></span><span class=line><span class=cl>rules:
</span></span><span class=line><span class=cl>- apiGroups:
</span></span><span class=line><span class=cl>  - &#34;&#34;
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>  - nodes/metrics
</span></span><span class=line><span class=cl>  verbs:
</span></span><span class=line><span class=cl>  - get
</span></span><span class=line><span class=cl>- apiGroups:
</span></span><span class=line><span class=cl>  - &#34;&#34;
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>  - pods
</span></span><span class=line><span class=cl>  - nodes
</span></span><span class=line><span class=cl>  verbs:
</span></span><span class=line><span class=cl>  - get
</span></span><span class=line><span class=cl>  - list
</span></span><span class=line><span class=cl>  - watch
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: RoleBinding
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: metrics-server-auth-reader
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>  kind: Role
</span></span><span class=line><span class=cl>  name: extension-apiserver-authentication-reader
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>- kind: ServiceAccount
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRoleBinding
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: metrics-server:system:auth-delegator
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>  kind: ClusterRole
</span></span><span class=line><span class=cl>  name: system:auth-delegator
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>- kind: ServiceAccount
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRoleBinding
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: system:metrics-server
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>  kind: ClusterRole
</span></span><span class=line><span class=cl>  name: system:metrics-server
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>- kind: ServiceAccount
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>  - name: https
</span></span><span class=line><span class=cl>    port: 443
</span></span><span class=line><span class=cl>    protocol: TCP
</span></span><span class=line><span class=cl>    targetPort: https
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: apps/v1
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      k8s-app: metrics-server
</span></span><span class=line><span class=cl>  strategy:
</span></span><span class=line><span class=cl>    rollingUpdate:
</span></span><span class=line><span class=cl>      maxUnavailable: 0
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        k8s-app: metrics-server
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - args:
</span></span><span class=line><span class=cl>        - --cert-dir=/tmp
</span></span><span class=line><span class=cl>        - --secure-port=4443
</span></span><span class=line><span class=cl>        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
</span></span><span class=line><span class=cl>        - --kubelet-use-node-status-port
</span></span><span class=line><span class=cl>        - --metric-resolution=15s
</span></span><span class=line><span class=cl>        - --kubelet-insecure-tls   #表示不验证客户端证书
</span></span><span class=line><span class=cl>        image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4  #使用阿里镜像
</span></span><span class=line><span class=cl>        imagePullPolicy: IfNotPresent
</span></span><span class=line><span class=cl>        livenessProbe:
</span></span><span class=line><span class=cl>          failureThreshold: 3
</span></span><span class=line><span class=cl>          httpGet:
</span></span><span class=line><span class=cl>            path: /livez
</span></span><span class=line><span class=cl>            port: https
</span></span><span class=line><span class=cl>            scheme: HTTPS
</span></span><span class=line><span class=cl>          periodSeconds: 10
</span></span><span class=line><span class=cl>        name: metrics-server
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 4443
</span></span><span class=line><span class=cl>          name: https
</span></span><span class=line><span class=cl>          protocol: TCP
</span></span><span class=line><span class=cl>        readinessProbe:
</span></span><span class=line><span class=cl>          failureThreshold: 3
</span></span><span class=line><span class=cl>          httpGet:
</span></span><span class=line><span class=cl>            path: /readyz
</span></span><span class=line><span class=cl>            port: https
</span></span><span class=line><span class=cl>            scheme: HTTPS
</span></span><span class=line><span class=cl>          initialDelaySeconds: 20
</span></span><span class=line><span class=cl>          periodSeconds: 10
</span></span><span class=line><span class=cl>        resources:
</span></span><span class=line><span class=cl>          requests:
</span></span><span class=line><span class=cl>            cpu: 100m
</span></span><span class=line><span class=cl>            memory: 200Mi
</span></span><span class=line><span class=cl>        securityContext:
</span></span><span class=line><span class=cl>          allowPrivilegeEscalation: false
</span></span><span class=line><span class=cl>          readOnlyRootFilesystem: true
</span></span><span class=line><span class=cl>          runAsNonRoot: true
</span></span><span class=line><span class=cl>          runAsUser: 1000
</span></span><span class=line><span class=cl>        volumeMounts:
</span></span><span class=line><span class=cl>        - mountPath: /tmp
</span></span><span class=line><span class=cl>          name: tmp-dir
</span></span><span class=line><span class=cl>      nodeSelector:
</span></span><span class=line><span class=cl>        kubernetes.io/os: linux
</span></span><span class=line><span class=cl>      priorityClassName: system-cluster-critical
</span></span><span class=line><span class=cl>      serviceAccountName: metrics-server
</span></span><span class=line><span class=cl>      volumes:
</span></span><span class=line><span class=cl>      - emptyDir: {}
</span></span><span class=line><span class=cl>        name: tmp-dir
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: apiregistration.k8s.io/v1
</span></span><span class=line><span class=cl>kind: APIService
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: metrics-server
</span></span><span class=line><span class=cl>  name: v1beta1.metrics.k8s.io
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  group: metrics.k8s.io
</span></span><span class=line><span class=cl>  groupPriorityMinimum: 100
</span></span><span class=line><span class=cl>  insecureSkipTLSVerify: true
</span></span><span class=line><span class=cl>  service:
</span></span><span class=line><span class=cl>    name: metrics-server
</span></span><span class=line><span class=cl>    namespace: kube-system
</span></span><span class=line><span class=cl>  version: v1beta1
</span></span><span class=line><span class=cl>  versionPriority: 100
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>kubectl apply -f components.yaml
</span></span></code></pre></td></tr></table></div></div><p>进行部署</p><p>另外还有一个dashboard可能会有点问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRole
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: system:metrics-server
</span></span><span class=line><span class=cl>rules:
</span></span><span class=line><span class=cl>- apiGroups:
</span></span><span class=line><span class=cl>  - &#34;&#34;
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>  - pods
</span></span><span class=line><span class=cl>  - nodes
</span></span><span class=line><span class=cl>  - nodes/stats
</span></span><span class=line><span class=cl>  - namespaces
</span></span><span class=line><span class=cl>  - configmaps
</span></span><span class=line><span class=cl>  - nodes/stats # 添加
</span></span><span class=line><span class=cl>  - pods/stats # 添加
</span></span><span class=line><span class=cl>  verbs:
</span></span><span class=line><span class=cl>  - get
</span></span><span class=line><span class=cl>  - list
</span></span><span class=line><span class=cl>  - watch
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRoleBinding
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: system:metrics-server
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>  kind: ClusterRole
</span></span><span class=line><span class=cl>  name: system:metrics-server
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>- kind: ServiceAccount
</span></span><span class=line><span class=cl>  name: metrics-server
</span></span><span class=line><span class=cl>  namespace: kube-system
</span></span></code></pre></td></tr></table></div></div><h1 id=参考文档>参考文档</h1><p><a href=https://jasonkayzk.github.io/2021/05/16/%E5%9C%A8VMWare%E4%B8%AD%E9%83%A8%E7%BD%B2%E4%BD%A0%E7%9A%84K8S%E9%9B%86%E7%BE%A4/>在VMWare中部署你的K8S集群</a></p><p><a href=https://jasonkayzk.github.io/2023/12/14/%E4%BD%BF%E7%94%A8Kuboard%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2Kubernetes%E9%9B%86%E7%BE%A4/>使用Kuboard快速部署Kubernetes集群</a></p><p><a href=https://www.jianshu.com/p/9b34807cb6d4>K8s dashboard 安装过程(Chrome无法打开)</a></p></section><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","Wh1teJ0ker/discussion"),s.setAttribute("data-repo-id","R_kgDOOTzcZA"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOOTzcZM4CoxXV"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","top"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div><div class=paginator><a class=prev href=https://wh1tej0ker.github.io/post/introduction-to-k8s-basics-2bouut.html><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>K8s基础介绍</span></a>
<a class=next href=https://wh1tej0ker.github.io/post/2024hscctf-d5uap.html><span>2024HSCCTF</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2025 <a href=https://wh1tej0ker.github.io/>Wh1teJ0kerのBlog</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg==" crossorigin=anonymous defer></script></html>