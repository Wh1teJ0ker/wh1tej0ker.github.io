<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Wh1teJ0kerのBlog</title>
<meta charset=utf-8><meta name=description content="Ladder@好难，无力了"><meta name=author content="Wh1teJ0ker"><link rel=canonical href=https://wh1tej0ker.github.io/post/2025-strong-network-mimicryfinal-17suma.html><link rel=alternate type=application/rss+xml href=https://wh1tej0ker.github.io//index.xml title=Wh1teJ0kerのBlog><script async defer data-website-id=56cc42c1-3656-4d3e-af3c-acded927b8ed src=https://analytics.umami.is/script.js></script><meta property="og:url" content="https://wh1tej0ker.github.io/post/2025-strong-network-mimicryfinal-17suma.html"><meta property="og:site_name" content="Wh1teJ0kerのBlog"><meta property="og:title" content="2025强网拟态-Final"><meta property="og:description" content="好难，无力了"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-11-27T11:16:36+08:00"><meta property="article:modified_time" content="2025-12-10T15:36:31+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="2025强网拟态-Final"><meta name=twitter:description content="好难，无力了"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wh1tej0ker.github.io/post/"},{"@type":"ListItem","position":2,"name":"2025强网拟态-Final","item":"https://wh1tej0ker.github.io/post/2025-strong-network-mimicryfinal-17suma.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2025强网拟态-Final","name":"2025强网拟态-Final","description":"好难，无力了","keywords":[],"articleBody":"2025强网拟态-Final Misc @脉冲星，友好合作\n标准的绝密压缩 首先分析流量，发现关键的PNG图片相关的流量，全部在tcp流的data部分，先使用tshark导出\n1 tshark -r input.pcap -Y \"tcp.payload\" -T fields -e tcp.payload 然后根据之前发现的长度重建恢复压缩包\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 #!/usr/bin/env python3 import sys, os from binascii import unhexlify SIG_PNG = '89504e470d0a1a0a' IEND = '49454e44' def read_from_data_txt(path): parts = [] with open(path, 'r', encoding='utf-8', errors='ignore') as f: for line in f: s = line.strip() if len(s) == 20 and all(c in '0123456789abcdefABCDEF' for c in s): b = bytes.fromhex(s) try: parts.append(b.decode('ascii')) except: parts.append(''.join(chr(x) for x in b)) return ''.join(parts) def read_from_decoded_txt(path): parts = [] with open(path, 'r', encoding='utf-8', errors='ignore') as f: for line in f: s = line.strip() if len(s) \u003e= 2 and all(c in '0123456789abcdefABCDEF' for c in s): parts.append(s) return ''.join(parts) def recover_pngs(hex_str, out_dir): os.makedirs(out_dir, exist_ok=True) paths = [] pos = 0 n = 0 L = len(hex_str) while True: idx = hex_str.find(SIG_PNG, pos) if idx == -1: break i = idx + len(SIG_PNG) while True: if i + 16 \u003e L: break length = int(hex_str[i:i+8], 16) i += 8 type_hex = hex_str[i:i+8] i += 8 data_hex_len = length * 2 if i + data_hex_len + 8 \u003e L: break i += data_hex_len crc_hex = hex_str[i:i+8] i += 8 if type_hex.lower() == IEND: break seg_hex = hex_str[idx:i] if seg_hex.startswith(SIG_PNG) and IEND in seg_hex: n += 1 p = os.path.join(out_dir, f'png_{n:03d}.png') with open(p, 'wb') as f: f.write(unhexlify(seg_hex)) paths.append(p) pos = i return paths def main(): args = sys.argv[1:] if not args: inp = './decoded.txt' out_dir = './recovered' mode = 'decoded' else: inp = args[0] out_dir = args[1] if len(args) \u003e 1 else 'recovered' mode = args[2] if len(args) \u003e 2 else 'decoded' if mode == 'data': hex_str = read_from_data_txt(inp) else: hex_str = read_from_decoded_txt(inp) paths = recover_pngs(hex_str, out_dir) print(len(paths)) if __name__ == '__main__': main() 恢复后发现在IDAT块内有问题\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #!/usr/bin/env python3 import os, re from binascii import unhexlify SRC = '/Users/joker/Code/2025QWNT_final/data_from_hex.txt' OUT_DIR = '/Users/joker/Code/2025QWNT_final/data_from_hex/recovered' SIG_PNG = '89504e470d0a1a0a' IEND = '49454e44' hex_tokens = [] pat = re.compile(r'[0-9a-fA-F]+') with open(SRC, 'r', encoding='utf-8', errors='ignore') as f: for line in f: for m in pat.finditer(line): s = m.group(0) if len(s) % 2 == 0: hex_tokens.append(s) hex_str = ''.join(hex_tokens).lower() os.makedirs(OUT_DIR, exist_ok=True) paths = [] pos = 0 n = 0 L = len(hex_str) while True: idx = hex_str.find(SIG_PNG, pos) if idx == -1: break i = idx + len(SIG_PNG) while True: if i + 16 \u003e L: break length = int(hex_str[i:i+8], 16) i += 8 type_hex = hex_str[i:i+8] i += 8 data_hex_len = length * 2 if i + data_hex_len + 8 \u003e L: break i += data_hex_len crc_hex = hex_str[i:i+8] i += 8 if type_hex.lower() == IEND: break seg_hex = hex_str[idx:i] if seg_hex.startswith(SIG_PNG) and IEND in seg_hex: n += 1 p = os.path.join(OUT_DIR, f'png_{n:03d}.png') with open(p, 'wb') as f2: f2.write(unhexlify(seg_hex)) paths.append(p) pos = i print(len(paths)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 png_001.png: Connection established. Hey, you online? It s been a while since we last talked. png_002.png: Yeah, I m here. Busy as always. Feels like the days are getting shorter. png_003.png: Tell me about it. I barely have time to sleep lately. Between maintenance logs and incident reports, I m drowning. png_004.png: Sounds rough. I ve been buried in audits myself. Every time I finish one, another pops up. png_005.png: Classic. Sometimes I wonder if the machines are easier to deal with than the people. png_006.png: No kidding. At least machines don t ask pointless questions. png_007.png: True. Anyway, before I forget how s that side project you were working on? The one you wouldn t shut up about months ago. png_008.png: Still alive barely. Progress is slow, but steady. You know me I don t give up easily. png_009.png: Good. I hope it pays off one day. png_010.png: Thanks. Alright I m guessing you didn t ping me just to chat? png_011.png: Well, half of it was. It s been a while. But yes I do have something for you today. Before sending the core cipher, I ll transmit an encrypted archive first. It contains a sample text and the decryption rules. png_012.png: Okay. What s special about this sample text? png_013.png: And inside the sample text, I used my favorite Herobrine legend you know the one I always bring up. png_014.png: Of course I know. The hidden original text from that weird old site, right? png_015.png: What can I say old habits die hard. Anyway, the important part: the sample packet and the core cipher are encrypted with the same password. png_016.png: Got it. So if I can decrypt the sample, the real one should be straightforward. png_017.png: Exactly. Send the sample when ready. png_018.png: I m ready. Go ahead. png_019.png: UEsDBBQAAQAIABtFeFu1Ii0dcwAAAHwAAAAJAAAAcnVsZXMudHh07XuRBFDbojGKhAz59VaKEpwD6/rKaZnqUxf+NMH0rybWrAMPewZ/yGyLrMKQjNIcEbPAxjmP5oTh8fP77Vi1wnFwzN37BmrQ9SCkC27FC/xeqbgw/HWcDpgzsEoiNpqT9ZThrbAScyg5syfJmNactjelNVBLAwQUAAEACACGOXhbpdvG1ysBAAAVAgAACgAAAHNhbXBsZS50eHTA1fy4cMLZwZkTI1mEk88yOXy9rmbTbCNBQOo9hqKQPK6vjZVo9aCtTVflmkKYGV99+51qXbinmG7WGik5UvLJk9MKRosThBCDMHrmjibOCzjzNELwEgEyX8DjqJkSc8pIFwj+oRM3bb4i0GtRxbwqgsxCtgwiKdCVoXVdetN7RKLIQ7DD+Huv/ZptNdd0yRNHis9LEA3loB+IHZ+dK7IknqPh4lYF8JwAjx5/wwp0YAM6Bcec7uAvk6B5t1pEztm1rLl8TjniVz5/bBUTo1LjUXnar/pnm1NvE9EAuxz/s6b+O8/ew7/A4ItdNJGzDudh6YULfiV3pCTXFIbR4GCe4LwkohWZIlAjysA+zLRrgkTDoB10vWdNGdfoBAlLRoUdZ95mS7X5/bXV41BLAQI/ABQAAQAIABtFeFu1Ii0dcwAAAHwAAAAJACQAAAAAAAAAIAAAAAAAAABydWxlcy50eHQKACAAAAAAAAEAGABIv3f82lzcAQAAAAAAAAAAAAAAAAAAAABQSwECPwAUAAEACACGOXhbpdvG1ysBAAAVAgAACgAkAAAAAAAAACAAAACaAAAAc2FtcGxlLnR4dAoAIAAAAAAAAQAYAFP0sZjOXNwBAAAAAAAAAAAAAAAAAAAAAFBLBQYAAAAAAgACALcAAADtAQAAAAA= png_020.png: got it. Decrypting yeah, it works. png_021.png: Good. That means the channel is stable. png_022.png: Alright. Whenever you re ready, send the real thing. png_023.png: The core cipher will be transmitted through our secret channel. You remember how to decrypt it, right? png_024.png: Of course. I ve got the procedure ready. Start when you re ready. png_025.png: Done. Core cipher fully received. Integrity verified no corruption. png_026.png: Same to you. And hey nice talking again. png_027.png: Agreed. Take care. png_028.png: Good. Keep things quiet for the next few days. png_029.png: Yeah. Let s not wait so long next time. png_030.png: You too. 下面是去查找原文在哪里\n1 It has been reported that some victims of torture, during the act, would retreat into a fantasy world from which they could not WAKE UP. In this catatonic state, the victim lived in a world just like their normal one, except they weren't being tortured. The only way that they realized they needed to WAKE UP was a note they found in their fantasy world. It would tell them about their condition, and tell them to WAKE UP. Even then, it would often take months until they were ready to discard their fantasy world and PLEASE WAKE UP. 开始明文攻击\n1 bkcrack.exe -C download.zip -c sample.txt -P sample.zip -p sample.txt 爆破出来了\n1 2 3 4 5 6 7 8 9 10 11 C:\\Users\\admin\\Desktop\\2025强网拟态\\bkcrack-1.8.1-win64\\bkcrack-1.8.1-win64\u003ebkcrack.exe -C download.zip -c sample.txt -P sample.zip -p sample.txt bkcrack 1.8.1 - 2025-10-25 [21:43:00] Z reduction using 280 bytes of known plaintext 100.0 % (280 / 280) [21:43:00] Attack on 28505 Z values at index 6 Keys: b47e923c 5aeb49a7 a3cd7af0 65.2 % (18580 / 28505) Found a solution. Stopping. You may resume the attack with the option: --continue-attack 18580 [21:43:09] Keys b47e923c 5aeb49a7 a3cd7af0 先将压缩包内的文本拿出来\n1 bkcrack.exe -C download.zip -k b47e923c 5aeb49a7 a3cd7af0 -U unlocked.zip 123 得到rules.txt\n1 2 1.you need to calc the md5 of port to decrypt the core data. 2.The cipher I put in the zip, in segments, has been deflated. 然后发现需要重建，因为未知端口，所以尝试爆破\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 from scapy.all import rdpcap, TCP, IP import pandas as pd from typing import Dict, List, Tuple import hashlib from Crypto.Cipher import AES from Crypto.Util.Padding import unpad import os def calculate_md5(num: int) -\u003e bytes: \"\"\"计算整数的MD5，返回字节格式作为AES密钥\"\"\" num_str = str(num) md5_hash = hashlib.md5(num_str.encode('utf-8')).hexdigest() # 对于AES-256，我们需要32字节密钥，所以用MD5重复填充到32字节 key = (md5_hash * 2)[:32].encode('utf-8') # 重复MD5并取前32字符 return key def aes_ecb_decrypt(ciphertext_hex: str, key: bytes) -\u003e bytes: \"\"\"使用AES-256-ECB解密数据\"\"\" try: ciphertext = bytes.fromhex(ciphertext_hex) ## if ciphertext.startswith(b\"8950\"): ## return f\"[AES解密错误: {str(e)}]\".encode() cipher = AES.new(key, AES.MODE_ECB) decrypted = cipher.decrypt(ciphertext) # 尝试去除PKCS7填充 try: decrypted = unpad(decrypted, AES.block_size) except ValueError: # 如果没有填充或者填充不正确，保持原样 pass return decrypted except Exception as e: return f\"[AES解密错误: {str(e)}]\".encode() def extract_tcp_communication(pcap_file: str, ip1: str, ip2: str) -\u003e List[Tuple[str, str, bytes]]: \"\"\" 从PCAP文件中提取两个IP的TCP通讯数据，按通讯方向和端口号分组 参数: pcap_file: PCAP/PCAPNG文件路径 ip1: 第一个目标IP ip2: 第二个目标IP 返回: 包含(方向端口、十六进制数据、解密数据)的元组列表 \"\"\" # 读取PCAP文件 print(f\"正在读取文件: {pcap_file}\") packets = rdpcap(pcap_file) print(f\"共读取到 {len(packets)} 个数据包\") # 存储筛选后的TCP数据 tcp_data: List[Dict] = [] # 遍历所有数据包，筛选目标IP的TCP通讯 for pkt in packets: # 只保留IP+TCP层的数据包 if IP in pkt and TCP in pkt: ip_layer = pkt[IP] tcp_layer = pkt[TCP] # 筛选条件：通讯双方必须是 ip1 和 ip2（双向都包含） src_ip = ip_layer.src dst_ip = ip_layer.dst if not ((src_ip == ip1 and dst_ip == ip2) or (src_ip == ip2 and dst_ip == ip1)): continue # 提取TCP关键信息 src_port = tcp_layer.sport dst_port = tcp_layer.dport payload = bytes(pkt[TCP].payload) if pkt[TCP].payload else b\"\" # 只处理有负载的数据包 if len(payload) \u003e 0: data = { \"src_ip\": src_ip, \"dst_ip\": dst_ip, \"src_port\": src_port, \"dst_port\": dst_port, \"timestamp\": pkt.time, \"seq_num\": tcp_layer.seq, \"payload\": payload, \"payload_len\": len(payload) } tcp_data.append(data) if not tcp_data: print(\"未找到目标IP之间的TCP通讯数据\") return [] # 转换为DataFrame，方便分组处理 df = pd.DataFrame(tcp_data) print(f\"筛选出 {len(df)} 个目标TCP数据包\") # 定义通讯方向和端口分组 df[\"方向端口\"] = df.apply( lambda x: f\"{x['src_ip']}:{x['src_port']}→{x['dst_ip']}:{x['dst_port']}\", axis=1 ) # 按通讯方向和端口分组，合并同组的TCP数据 def merge_tcp_direction(group: pd.DataFrame) -\u003e Tuple[str, str, bytes, int]: \"\"\"合并同一通讯方向和端口的TCP数据包\"\"\" direction = group[\"方向端口\"].iloc[0] src_port = group[\"src_port\"].iloc[0] # 按序列号排序，确保数据顺序正确 sorted_group = group.sort_values(\"seq_num\") # 合并所有负载数据 merged_payload = b\"\".join(sorted_group[\"payload\"].tolist()) # 转换为十六进制字符串 hex_data = merged_payload.hex() # 使用源端口的MD5作为AES密钥进行解密 aes_key = calculate_md5(src_port) if bytes.fromhex(hex_data).startswith(b\"8950\"): decrypted_data = \"\" else: decrypted_data = aes_ecb_decrypt(hex_data, aes_key) # 获取数据包数量 packet_count = len(group) return direction, hex_data, decrypted_data, packet_count, src_port # 按方向和端口分组合并 results = [] successful_decrypts = 0 failed_decrypts = 0 for direction_port, group in df.groupby(\"方向端口\"): result = merge_tcp_direction(group) direction, hex_data, decrypted_data, packet_count, src_port = result # 统计解密结果 if isinstance(decrypted_data, bytes) and decrypted_data: successful_decrypts += 1 status = \"成功\" else: failed_decrypts += 1 status = \"失败\" print(f\"方向: {direction_port}, 数据包: {packet_count}个, 解密: {status}\") results.append((direction_port, hex_data, decrypted_data, src_port)) print(f\"\\n解密统计: 成功 {successful_decrypts} 个, 失败 {failed_decrypts} 个\") return results def save_all_decrypted_data(results: List[Tuple[str, str, bytes, int]], output_dir: str = \"output\"): \"\"\"将每个流量的解密数据单独保存为ZIP文件\"\"\" # 创建输出目录 os.makedirs(output_dir, exist_ok=True) saved_files = [] for i, (direction_port, hex_data, decrypted_data, src_port) in enumerate(results, 1): if isinstance(decrypted_data, bytes) and decrypted_data: # 简洁的文件名：只使用索引 filename = f\"flow_{i:03d}.zip\" filepath = os.path.join(output_dir, filename) # 保存为ZIP文件 with open(filepath, 'wb') as f: f.write(decrypted_data) print(f\"保存文件: {filename}, 源端口: {src_port}, 长度: {len(decrypted_data)} 字节\") saved_files.append((filename, len(decrypted_data), src_port, direction_port)) print(f\"\\n所有解密数据已保存到目录: {output_dir}\") print(f\"总共保存了 {len(saved_files)} 个ZIP文件\") # 显示保存的文件统计 if saved_files: print(\"\\n=== 保存的文件列表 ===\") total_size = 0 for filename, size, src_port, direction in saved_files: print(f\" {filename} - 端口: {src_port} - {size} 字节\") print(f\" 方向: {direction}\") total_size += size print(f\"总数据大小: {total_size} 字节\") return saved_files if __name__ == \"__main__\": # 配置参数 PCAP_FILE = \"capture.pcapng\" # 你的PCAPNG文件路径 TARGET_IP1 = \"192.168.0.234\" # 目标IP1 TARGET_IP2 = \"120.232.61.180\" # 目标IP2 OUTPUT_FILE = \"all_decrypted_data.bin\" # 输出文件路径 # 检查依赖 try: from Crypto.Cipher import AES except ImportError: print(\"错误: 需要安装pycryptodome库\") print(\"请运行: pip install pycryptodome\") exit(1) # 执行提取和AES解密 print(\"开始提取TCP通讯并进行AES-256-ECB解密...\") results = extract_tcp_communication(PCAP_FILE, TARGET_IP1, TARGET_IP2) if results: # 分析解密数据 ## analyze_decrypted_data(results) # 保存所有解密数据到文件 ## os.makedirs(\"output_zip_files\", exist_ok=True) saved_files = save_all_decrypted_data(results, \"output_zip_files\") print(f\"\\n=== 完成 ===\") print(f\"总共处理了 {len(results)} 个通讯流\") print(f\"最终输出文件: {OUTPUT_FILE}\") else: print(\"未找到任何TCP通讯数据\") 爆破完后得到恢复的压缩包\n批量做CRC\n1 2 解密完成！总共解密了 319 字节 解密数据十六进制: 53290000cbae0200cb2c000053310400d3320400d3320200d3320000d332060033d5020033b20400d332010033340600334d0400334f0300d3320000d332020033d3020033d0020033360500d33200003331040033d602004bb6000033360500b34806004bb504004b350300b3300500b348030033340300333307003335060033330600334f01004b350400333105004b3100004bb60000333104004b4e05004bb504004b4d03004b3107004b4e03003332000033b000004b310400334e050033350500334c01004b310500b33001004b320300b34c06004b4c050033b50000b33405004b3607004b490300333105004b330600334a03004b4903004b320500334c010033480600334801003332070033b600003332000033320600b3b40000b33403004b3106004b350300d3520100d32f0000cbae0200cb2c0000530100 这一串数据得到\n1 $pkzip$1*1*2*0*35*29*4135a7f*0*26*0*35*0413*c8358ce9e6858f166753637de145d0c841cee9efd7cf2008d13e551dd584b69cae5895c7df45f32fdfb51d0c0d273820239896d3e6*$/pkzip$ 使用之前明文攻击得到的密钥恢复\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 import binascii cipher_hex = \"c8358ce9e6858f166753637de145d0c841cee9efd7cf2008d13e551dd584b69cae5895c7df45f32fdfb51d0c0d273820239896d3e6\" data = bytearray.fromhex(cipher_hex) key0 = 0xb47e923c key1 = 0x5aeb49a7 key2 = 0xa3cd7af0 crctab = [] for i in range(256): r = i for _ in range(8): if r \u0026 1: r = (r \u003e\u003e 1) ^ 0xEDB88320 else: r \u003e\u003e= 1 crctab.append(r) def update_keys(ch): global key0, key1, key2 key0 = crctab[(key0 ^ ch) \u0026 0xff] ^ (key0 \u003e\u003e 8) key1 = (key1 + (key0 \u0026 0xff)) \u0026 0xffffffff key1 = (key1 * 134775813 + 1) \u0026 0xffffffff key2 = crctab[(key2 ^ (key1 \u003e\u003e 24)) \u0026 0xff] ^ (key2 \u003e\u003e 8) def decrypt_byte(): temp = (key2 | 3) \u0026 0xffff return ((temp * (temp ^ 1)) \u003e\u003e 8) \u0026 0xff plain = bytearray() for c in data: k = decrypt_byte() p = c ^ k plain.append(p) update_keys(p) print(\"解密明文（hex）:\") print(plain.hex()) print(\"\\n解密明文:\") print(''.join(chr(b) if 32 \u003c= b \u003c= 126 else '.' for b in plain)) ","wordCount":"3891","inLanguage":"en","datePublished":"2025-11-27T11:16:36+08:00","dateModified":"2025-12-10T15:36:31+08:00","author":{"@type":"Person","name":"Wh1teJ0ker"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wh1tej0ker.github.io/post/2025-strong-network-mimicryfinal-17suma.html"},"publisher":{"@type":"Organization","name":"Wh1teJ0kerのBlog","logo":{"@type":"ImageObject","url":"https://wh1tej0ker.github.io/favicon.ico"}}}</script><link rel=icon type=image/png href=/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/favicon.ico><link rel=manifest href=/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.10261e11331d1957a67a7a72f16bb5db1759ff46265895f1ecb6d0309da4eb43.css integrity="sha256-ECYeETMdGVemenpy8Wu12xdZ/0YmWJXx7LbQMJ2k60M=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/categories/>分类</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives/>归档</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/friends/>友链</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/about/>关于</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=https://cloud.umami.is/share/5RZUCwaG2fOysYPa/wh1tej0ker.github.io>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/Wh1teJ0ker><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-search"><a href=javascript:void(0) id=search-btn><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>2025强网拟态-Final</h1></header><p><small>November 27, 2025&nbsp;· &nbsp;·</small><p><div class=blog-body><div class=blog-toc><details open class=toc-details><summary class=toc-summary>目录</summary><div class=toc-content><nav id=TableOfContents><ul><li><a href=#标准的绝密压缩>标准的绝密压缩</a></li></ul></nav></div></details></div><div class=blog-content-wrapper><section class=blog-content><h1 id=2025强网拟态-final>2025强网拟态-Final</h1><h1 id=misc>Misc</h1><p>@脉冲星，友好合作</p><h2 id=标准的绝密压缩>标准的绝密压缩</h2><p>首先分析流量，发现关键的PNG图片相关的流量，全部在tcp流的data部分，先使用tshark导出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tshark -r input.pcap -Y <span class=s2>&#34;tcp.payload&#34;</span> -T fields -e tcp.payload
</span></span></code></pre></td></tr></table></div></div><p>然后根据之前发现的长度重建恢复压缩包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>binascii</span> <span class=kn>import</span> <span class=n>unhexlify</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SIG_PNG</span> <span class=o>=</span> <span class=s1>&#39;89504e470d0a1a0a&#39;</span>
</span></span><span class=line><span class=cl><span class=n>IEND</span> <span class=o>=</span> <span class=s1>&#39;49454e44&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_from_data_txt</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>20</span> <span class=ow>and</span> <span class=nb>all</span><span class=p>(</span><span class=n>c</span> <span class=ow>in</span> <span class=s1>&#39;0123456789abcdefABCDEF&#39;</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>b</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>b</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_from_decoded_txt</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=ow>and</span> <span class=nb>all</span><span class=p>(</span><span class=n>c</span> <span class=ow>in</span> <span class=s1>&#39;0123456789abcdefABCDEF&#39;</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>recover_pngs</span><span class=p>(</span><span class=n>hex_str</span><span class=p>,</span> <span class=n>out_dir</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>out_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>paths</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>pos</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>hex_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>idx</span> <span class=o>=</span> <span class=n>hex_str</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>SIG_PNG</span><span class=p>,</span> <span class=n>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>idx</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=n>idx</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>SIG_PNG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>&gt;</span> <span class=n>L</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=n>length</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>hex_str</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>            <span class=n>type_hex</span> <span class=o>=</span> <span class=n>hex_str</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>            <span class=n>data_hex_len</span> <span class=o>=</span> <span class=n>length</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>i</span> <span class=o>+</span> <span class=n>data_hex_len</span> <span class=o>+</span> <span class=mi>8</span> <span class=o>&gt;</span> <span class=n>L</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=n>data_hex_len</span>
</span></span><span class=line><span class=cl>            <span class=n>crc_hex</span> <span class=o>=</span> <span class=n>hex_str</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>type_hex</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=n>IEND</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>seg_hex</span> <span class=o>=</span> <span class=n>hex_str</span><span class=p>[</span><span class=n>idx</span><span class=p>:</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>seg_hex</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>SIG_PNG</span><span class=p>)</span> <span class=ow>and</span> <span class=n>IEND</span> <span class=ow>in</span> <span class=n>seg_hex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>n</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>out_dir</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;png_</span><span class=si>{</span><span class=n>n</span><span class=si>:</span><span class=s1>03d</span><span class=si>}</span><span class=s1>.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>seg_hex</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pos</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>paths</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>args</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>inp</span> <span class=o>=</span> <span class=s1>&#39;./decoded.txt&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>out_dir</span> <span class=o>=</span> <span class=s1>&#39;./recovered&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span> <span class=o>=</span> <span class=s1>&#39;decoded&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>inp</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>out_dir</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=k>else</span> <span class=s1>&#39;recovered&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s1>&#39;decoded&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>mode</span> <span class=o>==</span> <span class=s1>&#39;data&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>hex_str</span> <span class=o>=</span> <span class=n>read_from_data_txt</span><span class=p>(</span><span class=n>inp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>hex_str</span> <span class=o>=</span> <span class=n>read_from_decoded_txt</span><span class=p>(</span><span class=n>inp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>paths</span> <span class=o>=</span> <span class=n>recover_pngs</span><span class=p>(</span><span class=n>hex_str</span><span class=p>,</span> <span class=n>out_dir</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>paths</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251127112219-5uuiq74.png alt=image></p><p>恢复后发现在IDAT块内有问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>binascii</span> <span class=kn>import</span> <span class=n>unhexlify</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SRC</span> <span class=o>=</span> <span class=s1>&#39;/Users/joker/Code/2025QWNT_final/data_from_hex.txt&#39;</span>
</span></span><span class=line><span class=cl><span class=n>OUT_DIR</span> <span class=o>=</span> <span class=s1>&#39;/Users/joker/Code/2025QWNT_final/data_from_hex/recovered&#39;</span>
</span></span><span class=line><span class=cl><span class=n>SIG_PNG</span> <span class=o>=</span> <span class=s1>&#39;89504e470d0a1a0a&#39;</span>
</span></span><span class=line><span class=cl><span class=n>IEND</span> <span class=o>=</span> <span class=s1>&#39;49454e44&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hex_tokens</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>pat</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[0-9a-fA-F]+&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>SRC</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>pat</span><span class=o>.</span><span class=n>finditer</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>hex_tokens</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hex_str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>hex_tokens</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>OUT_DIR</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>paths</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>pos</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>L</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>hex_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>idx</span> <span class=o>=</span> <span class=n>hex_str</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>SIG_PNG</span><span class=p>,</span> <span class=n>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>idx</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=n>idx</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>SIG_PNG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>&gt;</span> <span class=n>L</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>length</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>hex_str</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=n>type_hex</span> <span class=o>=</span> <span class=n>hex_str</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=n>data_hex_len</span> <span class=o>=</span> <span class=n>length</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>+</span> <span class=n>data_hex_len</span> <span class=o>+</span> <span class=mi>8</span> <span class=o>&gt;</span> <span class=n>L</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=n>data_hex_len</span>
</span></span><span class=line><span class=cl>        <span class=n>crc_hex</span> <span class=o>=</span> <span class=n>hex_str</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>type_hex</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=n>IEND</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=n>seg_hex</span> <span class=o>=</span> <span class=n>hex_str</span><span class=p>[</span><span class=n>idx</span><span class=p>:</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>seg_hex</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>SIG_PNG</span><span class=p>)</span> <span class=ow>and</span> <span class=n>IEND</span> <span class=ow>in</span> <span class=n>seg_hex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>OUT_DIR</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;png_</span><span class=si>{</span><span class=n>n</span><span class=si>:</span><span class=s1>03d</span><span class=si>}</span><span class=s1>.png&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>f2</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>unhexlify</span><span class=p>(</span><span class=n>seg_hex</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pos</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>paths</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>png_001</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Connection</span> <span class=n>established</span><span class=o>.</span> <span class=n>Hey</span><span class=p>,</span> <span class=n>you</span> <span class=n>online</span><span class=err>?</span> <span class=n>It</span> <span class=n>s</span> <span class=n>been</span> <span class=n>a</span> <span class=k>while</span> <span class=n>since</span> <span class=n>we</span> <span class=n>last</span> <span class=n>talked</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_002</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Yeah</span><span class=p>,</span> <span class=n>I</span> <span class=n>m</span> <span class=n>here</span><span class=o>.</span> <span class=n>Busy</span> <span class=k>as</span> <span class=n>always</span><span class=o>.</span> <span class=n>Feels</span> <span class=n>like</span> <span class=n>the</span> <span class=n>days</span> <span class=n>are</span> <span class=n>getting</span> <span class=n>shorter</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_003</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Tell</span> <span class=n>me</span> <span class=n>about</span> <span class=n>it</span><span class=o>.</span> <span class=n>I</span> <span class=n>barely</span> <span class=n>have</span> <span class=n>time</span> <span class=n>to</span> <span class=n>sleep</span> <span class=n>lately</span><span class=o>.</span> <span class=n>Between</span> <span class=n>maintenance</span> <span class=n>logs</span> <span class=ow>and</span> <span class=n>incident</span> <span class=n>reports</span><span class=p>,</span> <span class=n>I</span> <span class=n>m</span> <span class=n>drowning</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_004</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Sounds</span> <span class=n>rough</span><span class=o>.</span> <span class=n>I</span> <span class=n>ve</span> <span class=n>been</span> <span class=n>buried</span> <span class=ow>in</span> <span class=n>audits</span> <span class=n>myself</span><span class=o>.</span> <span class=n>Every</span> <span class=n>time</span> <span class=n>I</span> <span class=n>finish</span> <span class=n>one</span><span class=p>,</span> <span class=n>another</span> <span class=n>pops</span> <span class=n>up</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_005</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Classic</span><span class=o>.</span> <span class=n>Sometimes</span> <span class=n>I</span> <span class=n>wonder</span> <span class=k>if</span> <span class=n>the</span> <span class=n>machines</span> <span class=n>are</span> <span class=n>easier</span> <span class=n>to</span> <span class=n>deal</span> <span class=k>with</span> <span class=n>than</span> <span class=n>the</span> <span class=n>people</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_006</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>No</span> <span class=n>kidding</span><span class=o>.</span> <span class=n>At</span> <span class=n>least</span> <span class=n>machines</span> <span class=n>don</span> <span class=n>t</span> <span class=n>ask</span> <span class=n>pointless</span> <span class=n>questions</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_007</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=kc>True</span><span class=o>.</span> <span class=n>Anyway</span><span class=p>,</span> <span class=n>before</span> <span class=n>I</span> <span class=n>forget</span> <span class=n>how</span> <span class=n>s</span> <span class=n>that</span> <span class=n>side</span> <span class=n>project</span> <span class=n>you</span> <span class=n>were</span> <span class=n>working</span> <span class=n>on</span><span class=err>?</span> <span class=n>The</span> <span class=n>one</span> <span class=n>you</span> <span class=n>wouldn</span> <span class=n>t</span> <span class=n>shut</span> <span class=n>up</span> <span class=n>about</span> <span class=n>months</span> <span class=n>ago</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_008</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Still</span> <span class=n>alive</span> <span class=n>barely</span><span class=o>.</span> <span class=n>Progress</span> <span class=ow>is</span> <span class=n>slow</span><span class=p>,</span> <span class=n>but</span> <span class=n>steady</span><span class=o>.</span> <span class=n>You</span> <span class=n>know</span> <span class=n>me</span> <span class=n>I</span> <span class=n>don</span> <span class=n>t</span> <span class=n>give</span> <span class=n>up</span> <span class=n>easily</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_009</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Good</span><span class=o>.</span> <span class=n>I</span> <span class=n>hope</span> <span class=n>it</span> <span class=n>pays</span> <span class=n>off</span> <span class=n>one</span> <span class=n>day</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_010</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Thanks</span><span class=o>.</span> <span class=n>Alright</span> <span class=n>I</span> <span class=n>m</span> <span class=n>guessing</span> <span class=n>you</span> <span class=n>didn</span> <span class=n>t</span> <span class=n>ping</span> <span class=n>me</span> <span class=n>just</span> <span class=n>to</span> <span class=n>chat</span><span class=err>?</span>
</span></span><span class=line><span class=cl><span class=n>png_011</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Well</span><span class=p>,</span> <span class=n>half</span> <span class=n>of</span> <span class=n>it</span> <span class=n>was</span><span class=o>.</span> <span class=n>It</span> <span class=n>s</span> <span class=n>been</span> <span class=n>a</span> <span class=k>while</span><span class=o>.</span> <span class=n>But</span> <span class=n>yes</span> <span class=n>I</span> <span class=n>do</span> <span class=n>have</span> <span class=n>something</span> <span class=k>for</span> <span class=n>you</span> <span class=n>today</span><span class=o>.</span> <span class=n>Before</span> <span class=n>sending</span> <span class=n>the</span> <span class=n>core</span> <span class=n>cipher</span><span class=p>,</span> <span class=n>I</span> <span class=n>ll</span> <span class=n>transmit</span> <span class=n>an</span> <span class=n>encrypted</span> <span class=n>archive</span> <span class=n>first</span><span class=o>.</span> <span class=n>It</span> <span class=n>contains</span> <span class=n>a</span> <span class=n>sample</span> <span class=n>text</span> <span class=ow>and</span> <span class=n>the</span> <span class=n>decryption</span> <span class=n>rules</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_012</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Okay</span><span class=o>.</span> <span class=n>What</span> <span class=n>s</span> <span class=n>special</span> <span class=n>about</span> <span class=n>this</span> <span class=n>sample</span> <span class=n>text</span><span class=err>?</span>
</span></span><span class=line><span class=cl><span class=n>png_013</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>And</span> <span class=n>inside</span> <span class=n>the</span> <span class=n>sample</span> <span class=n>text</span><span class=p>,</span> <span class=n>I</span> <span class=n>used</span> <span class=n>my</span> <span class=n>favorite</span> <span class=n>Herobrine</span> <span class=n>legend</span> <span class=n>you</span> <span class=n>know</span> <span class=n>the</span> <span class=n>one</span> <span class=n>I</span> <span class=n>always</span> <span class=n>bring</span> <span class=n>up</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_014</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Of</span> <span class=n>course</span> <span class=n>I</span> <span class=n>know</span><span class=o>.</span> <span class=n>The</span> <span class=n>hidden</span> <span class=n>original</span> <span class=n>text</span> <span class=kn>from</span> <span class=nn>that</span> <span class=n>weird</span> <span class=n>old</span> <span class=n>site</span><span class=p>,</span> <span class=n>right</span><span class=err>?</span>
</span></span><span class=line><span class=cl><span class=n>png_015</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>What</span> <span class=n>can</span> <span class=n>I</span> <span class=n>say</span> <span class=n>old</span> <span class=n>habits</span> <span class=n>die</span> <span class=n>hard</span><span class=o>.</span> <span class=n>Anyway</span><span class=p>,</span> <span class=n>the</span> <span class=n>important</span> <span class=n>part</span><span class=p>:</span> <span class=n>the</span> <span class=n>sample</span> <span class=n>packet</span> <span class=ow>and</span> <span class=n>the</span> <span class=n>core</span> <span class=n>cipher</span> <span class=n>are</span> <span class=n>encrypted</span> <span class=k>with</span> <span class=n>the</span> <span class=n>same</span> <span class=n>password</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_016</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Got</span> <span class=n>it</span><span class=o>.</span> <span class=n>So</span> <span class=k>if</span> <span class=n>I</span> <span class=n>can</span> <span class=n>decrypt</span> <span class=n>the</span> <span class=n>sample</span><span class=p>,</span> <span class=n>the</span> <span class=n>real</span> <span class=n>one</span> <span class=n>should</span> <span class=n>be</span> <span class=n>straightforward</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_017</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Exactly</span><span class=o>.</span> <span class=n>Send</span> <span class=n>the</span> <span class=n>sample</span> <span class=n>when</span> <span class=n>ready</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_018</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>I</span> <span class=n>m</span> <span class=n>ready</span><span class=o>.</span> <span class=n>Go</span> <span class=n>ahead</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_019</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>UEsDBBQAAQAIABtFeFu1Ii0dcwAAAHwAAAAJAAAAcnVsZXMudHh07XuRBFDbojGKhAz59VaKEpwD6</span><span class=o>/</span><span class=n>rKaZnqUxf</span><span class=o>+</span><span class=n>NMH0rybWrAMPewZ</span><span class=o>/</span><span class=n>yGyLrMKQjNIcEbPAxjmP5oTh8fP77Vi1wnFwzN37BmrQ9SCkC27FC</span><span class=o>/</span><span class=n>xeqbgw</span><span class=o>/</span><span class=n>HWcDpgzsEoiNpqT9ZThrbAScyg5syfJmNactjelNVBLAwQUAAEACACGOXhbpdvG1ysBAAAVAgAACgAAAHNhbXBsZS50eHTA1fy4cMLZwZkTI1mEk88yOXy9rmbTbCNBQOo9hqKQPK6vjZVo9aCtTVflmkKYGV99</span><span class=o>+</span><span class=mi>51</span><span class=n>qXbinmG7WGik5UvLJk9MKRosThBCDMHrmjibOCzjzNELwEgEyX8DjqJkSc8pIFwj</span><span class=o>+</span><span class=n>oRM3bb4i0GtRxbwqgsxCtgwiKdCVoXVdetN7RKLIQ7DD</span><span class=o>+</span><span class=n>Huv</span><span class=o>/</span><span class=n>ZptNdd0yRNHis9LEA3loB</span><span class=o>+</span><span class=n>IHZ</span><span class=o>+</span><span class=n>dK7IknqPh4lYF8JwAjx5</span><span class=o>/</span><span class=n>wwp0YAM6Bcec7uAvk6B5t1pEztm1rLl8TjniVz5</span><span class=o>/</span><span class=n>bBUTo1LjUXnar</span><span class=o>/</span><span class=n>pnm1NvE9EAuxz</span><span class=o>/</span><span class=n>s6b</span><span class=o>+</span><span class=n>O8</span><span class=o>/</span><span class=n>ew7</span><span class=o>/</span><span class=n>A4ItdNJGzDudh6YULfiV3pCTXFIbR4GCe4LwkohWZIlAjysA</span><span class=o>+</span><span class=n>zLRrgkTDoB10vWdNGdfoBAlLRoUdZ95mS7X5</span><span class=o>/</span><span class=n>bXV41BLAQI</span><span class=o>/</span><span class=n>ABQAAQAIABtFeFu1Ii0dcwAAAHwAAAAJACQAAAAAAAAAIAAAAAAAAABydWxlcy50eHQKACAAAAAAAAEAGABIv3f82lzcAQAAAAAAAAAAAAAAAAAAAABQSwECPwAUAAEACACGOXhbpdvG1ysBAAAVAgAACgAkAAAAAAAAACAAAACaAAAAc2FtcGxlLnR4dAoAIAAAAAAAAQAYAFP0sZjOXNwBAAAAAAAAAAAAAAAAAAAAAFBLBQYAAAAAAgACALcAAADtAQAAAAA</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>png_020</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>got</span> <span class=n>it</span><span class=o>.</span> <span class=n>Decrypting</span> <span class=n>yeah</span><span class=p>,</span> <span class=n>it</span> <span class=n>works</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_021</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Good</span><span class=o>.</span> <span class=n>That</span> <span class=n>means</span> <span class=n>the</span> <span class=n>channel</span> <span class=ow>is</span> <span class=n>stable</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_022</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Alright</span><span class=o>.</span> <span class=n>Whenever</span> <span class=n>you</span> <span class=n>re</span> <span class=n>ready</span><span class=p>,</span> <span class=n>send</span> <span class=n>the</span> <span class=n>real</span> <span class=n>thing</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_023</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>The</span> <span class=n>core</span> <span class=n>cipher</span> <span class=n>will</span> <span class=n>be</span> <span class=n>transmitted</span> <span class=n>through</span> <span class=n>our</span> <span class=n>secret</span> <span class=n>channel</span><span class=o>.</span> <span class=n>You</span> <span class=n>remember</span> <span class=n>how</span> <span class=n>to</span> <span class=n>decrypt</span> <span class=n>it</span><span class=p>,</span> <span class=n>right</span><span class=err>?</span>
</span></span><span class=line><span class=cl><span class=n>png_024</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Of</span> <span class=n>course</span><span class=o>.</span> <span class=n>I</span> <span class=n>ve</span> <span class=n>got</span> <span class=n>the</span> <span class=n>procedure</span> <span class=n>ready</span><span class=o>.</span> <span class=n>Start</span> <span class=n>when</span> <span class=n>you</span> <span class=n>re</span> <span class=n>ready</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_025</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Done</span><span class=o>.</span> <span class=n>Core</span> <span class=n>cipher</span> <span class=n>fully</span> <span class=n>received</span><span class=o>.</span> <span class=n>Integrity</span> <span class=n>verified</span> <span class=n>no</span> <span class=n>corruption</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_026</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Same</span> <span class=n>to</span> <span class=n>you</span><span class=o>.</span> <span class=n>And</span> <span class=n>hey</span> <span class=n>nice</span> <span class=n>talking</span> <span class=n>again</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_027</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Agreed</span><span class=o>.</span> <span class=n>Take</span> <span class=n>care</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_028</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Good</span><span class=o>.</span> <span class=n>Keep</span> <span class=n>things</span> <span class=n>quiet</span> <span class=k>for</span> <span class=n>the</span> <span class=nb>next</span> <span class=n>few</span> <span class=n>days</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_029</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>Yeah</span><span class=o>.</span> <span class=n>Let</span> <span class=n>s</span> <span class=ow>not</span> <span class=n>wait</span> <span class=n>so</span> <span class=n>long</span> <span class=nb>next</span> <span class=n>time</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>png_030</span><span class=o>.</span><span class=n>png</span><span class=p>:</span> <span class=n>You</span> <span class=n>too</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><p>下面是去查找原文在哪里</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>It has been reported that some victims of torture, during the act, would retreat into a fantasy world from which they could not WAKE UP. In this catatonic state, the victim lived in a world just like their normal one, except they weren<span class=err>&#39;</span>t being tortured. The only way that they realized they needed to WAKE UP was a note they found in their fantasy world. It would tell them about their condition, and tell them to WAKE UP. Even <span class=k>then</span>, it would often take months <span class=k>until</span> they were ready to discard their fantasy world and PLEASE WAKE UP.
</span></span></code></pre></td></tr></table></div></div><p>开始明文攻击</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bkcrack.exe -C download.zip -c sample.txt -P sample.zip -p sample.txt
</span></span></code></pre></td></tr></table></div></div><p>爆破出来了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>C:<span class=se>\U</span>sers<span class=se>\a</span>dmin<span class=se>\D</span>esktop<span class=se>\2</span>025强网拟态<span class=se>\b</span>kcrack-1.8.1-win64<span class=se>\b</span>kcrack-1.8.1-win64&gt;bkcrack.exe -C download.zip -c sample.txt -P sample.zip -p sample.txt
</span></span><span class=line><span class=cl>bkcrack 1.8.1 - 2025-10-25
</span></span><span class=line><span class=cl><span class=o>[</span>21:43:00<span class=o>]</span> Z reduction using <span class=m>280</span> bytes of known plaintext
</span></span><span class=line><span class=cl>100.0 % <span class=o>(</span><span class=m>280</span> / 280<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>21:43:00<span class=o>]</span> Attack on <span class=m>28505</span> Z values at index <span class=m>6</span>
</span></span><span class=line><span class=cl>Keys: b47e923c 5aeb49a7 a3cd7af0
</span></span><span class=line><span class=cl>65.2 % <span class=o>(</span><span class=m>18580</span> / 28505<span class=o>)</span>
</span></span><span class=line><span class=cl>Found a solution. Stopping.
</span></span><span class=line><span class=cl>You may resume the attack with the option: --continue-attack <span class=m>18580</span>
</span></span><span class=line><span class=cl><span class=o>[</span>21:43:09<span class=o>]</span> Keys
</span></span><span class=line><span class=cl>b47e923c 5aeb49a7 a3cd7af0
</span></span></code></pre></td></tr></table></div></div><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251127214331-wpjk8bm.png alt=image></p><p>先将压缩包内的文本拿出来</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bkcrack.exe -C download.zip -k b47e923c 5aeb49a7 a3cd7af0 -U unlocked.zip <span class=m>123</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251127215237-6m1bghg.png alt=image></p><p>得到rules.txt</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mf>1.</span><span class=n>you</span> <span class=n>need</span> <span class=n>to</span> <span class=n>calc</span> <span class=n>the</span> <span class=n>md5</span> <span class=n>of</span> <span class=n>port</span> <span class=n>to</span> <span class=n>decrypt</span> <span class=n>the</span> <span class=n>core</span> <span class=n>data</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=mf>2.</span><span class=n>The</span> <span class=n>cipher</span> <span class=n>I</span> <span class=n>put</span> <span class=ow>in</span> <span class=n>the</span> <span class=nb>zip</span><span class=p>,</span> <span class=ow>in</span> <span class=n>segments</span><span class=p>,</span> <span class=n>has</span> <span class=n>been</span> <span class=n>deflated</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><p>然后发现需要重建，因为未知端口，所以尝试爆破</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scapy.all</span> <span class=kn>import</span> <span class=n>rdpcap</span><span class=p>,</span> <span class=n>TCP</span><span class=p>,</span> <span class=n>IP</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Tuple</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_md5</span><span class=p>(</span><span class=n>num</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;计算整数的MD5，返回字节格式作为AES密钥&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>num_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>md5_hash</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>num_str</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 对于AES-256，我们需要32字节密钥，所以用MD5重复填充到32字节</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=p>(</span><span class=n>md5_hash</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)[:</span><span class=mi>32</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>  <span class=c1># 重复MD5并取前32字符</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_ecb_decrypt</span><span class=p>(</span><span class=n>ciphertext_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;使用AES-256-ECB解密数据&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>ciphertext_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>##        if ciphertext.startswith(b&#34;8950&#34;):</span>
</span></span><span class=line><span class=cl><span class=c1>##            return f&#34;[AES解密错误: {str(e)}]&#34;.encode()</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 尝试去除PKCS7填充</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>decrypted</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 如果没有填充或者填充不正确，保持原样</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;[AES解密错误: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>]&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_tcp_communication</span><span class=p>(</span><span class=n>pcap_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ip1</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>ip2</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    从PCAP文件中提取两个IP的TCP通讯数据，按通讯方向和端口号分组
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    参数:
</span></span></span><span class=line><span class=cl><span class=s2>        pcap_file: PCAP/PCAPNG文件路径
</span></span></span><span class=line><span class=cl><span class=s2>        ip1: 第一个目标IP
</span></span></span><span class=line><span class=cl><span class=s2>        ip2: 第二个目标IP
</span></span></span><span class=line><span class=cl><span class=s2>    返回:
</span></span></span><span class=line><span class=cl><span class=s2>        包含(方向端口、十六进制数据、解密数据)的元组列表
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 读取PCAP文件</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;正在读取文件: </span><span class=si>{</span><span class=n>pcap_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>packets</span> <span class=o>=</span> <span class=n>rdpcap</span><span class=p>(</span><span class=n>pcap_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;共读取到 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>packets</span><span class=p>)</span><span class=si>}</span><span class=s2> 个数据包&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 存储筛选后的TCP数据</span>
</span></span><span class=line><span class=cl>    <span class=n>tcp_data</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 遍历所有数据包，筛选目标IP的TCP通讯</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pkt</span> <span class=ow>in</span> <span class=n>packets</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 只保留IP+TCP层的数据包</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>IP</span> <span class=ow>in</span> <span class=n>pkt</span> <span class=ow>and</span> <span class=n>TCP</span> <span class=ow>in</span> <span class=n>pkt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ip_layer</span> <span class=o>=</span> <span class=n>pkt</span><span class=p>[</span><span class=n>IP</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>tcp_layer</span> <span class=o>=</span> <span class=n>pkt</span><span class=p>[</span><span class=n>TCP</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 筛选条件：通讯双方必须是 ip1 和 ip2（双向都包含）</span>
</span></span><span class=line><span class=cl>            <span class=n>src_ip</span> <span class=o>=</span> <span class=n>ip_layer</span><span class=o>.</span><span class=n>src</span>
</span></span><span class=line><span class=cl>            <span class=n>dst_ip</span> <span class=o>=</span> <span class=n>ip_layer</span><span class=o>.</span><span class=n>dst</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=p>((</span><span class=n>src_ip</span> <span class=o>==</span> <span class=n>ip1</span> <span class=ow>and</span> <span class=n>dst_ip</span> <span class=o>==</span> <span class=n>ip2</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>src_ip</span> <span class=o>==</span> <span class=n>ip2</span> <span class=ow>and</span> <span class=n>dst_ip</span> <span class=o>==</span> <span class=n>ip1</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 提取TCP关键信息</span>
</span></span><span class=line><span class=cl>            <span class=n>src_port</span> <span class=o>=</span> <span class=n>tcp_layer</span><span class=o>.</span><span class=n>sport</span>
</span></span><span class=line><span class=cl>            <span class=n>dst_port</span> <span class=o>=</span> <span class=n>tcp_layer</span><span class=o>.</span><span class=n>dport</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>pkt</span><span class=p>[</span><span class=n>TCP</span><span class=p>]</span><span class=o>.</span><span class=n>payload</span><span class=p>)</span> <span class=k>if</span> <span class=n>pkt</span><span class=p>[</span><span class=n>TCP</span><span class=p>]</span><span class=o>.</span><span class=n>payload</span> <span class=k>else</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 只处理有负载的数据包</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;src_ip&#34;</span><span class=p>:</span> <span class=n>src_ip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;dst_ip&#34;</span><span class=p>:</span> <span class=n>dst_ip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;src_port&#34;</span><span class=p>:</span> <span class=n>src_port</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;dst_port&#34;</span><span class=p>:</span> <span class=n>dst_port</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;timestamp&#34;</span><span class=p>:</span> <span class=n>pkt</span><span class=o>.</span><span class=n>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;seq_num&#34;</span><span class=p>:</span> <span class=n>tcp_layer</span><span class=o>.</span><span class=n>seq</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;payload&#34;</span><span class=p>:</span> <span class=n>payload</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;payload_len&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>tcp_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>tcp_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;未找到目标IP之间的TCP通讯数据&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 转换为DataFrame，方便分组处理</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>tcp_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;筛选出 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span><span class=si>}</span><span class=s2> 个目标TCP数据包&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 定义通讯方向和端口分组</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s2>&#34;方向端口&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;src_ip&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;src_port&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>→</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;dst_ip&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>x</span><span class=p>[</span><span class=s1>&#39;dst_port&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 按通讯方向和端口分组，合并同组的TCP数据</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>merge_tcp_direction</span><span class=p>(</span><span class=n>group</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;合并同一通讯方向和端口的TCP数据包&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>direction</span> <span class=o>=</span> <span class=n>group</span><span class=p>[</span><span class=s2>&#34;方向端口&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>src_port</span> <span class=o>=</span> <span class=n>group</span><span class=p>[</span><span class=s2>&#34;src_port&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 按序列号排序，确保数据顺序正确</span>
</span></span><span class=line><span class=cl>        <span class=n>sorted_group</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=s2>&#34;seq_num&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 合并所有负载数据</span>
</span></span><span class=line><span class=cl>        <span class=n>merged_payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sorted_group</span><span class=p>[</span><span class=s2>&#34;payload&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 转换为十六进制字符串</span>
</span></span><span class=line><span class=cl>        <span class=n>hex_data</span> <span class=o>=</span> <span class=n>merged_payload</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 使用源端口的MD5作为AES密钥进行解密</span>
</span></span><span class=line><span class=cl>        <span class=n>aes_key</span> <span class=o>=</span> <span class=n>calculate_md5</span><span class=p>(</span><span class=n>src_port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hex_data</span><span class=p>)</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;8950&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>decrypted_data</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>decrypted_data</span> <span class=o>=</span> <span class=n>aes_ecb_decrypt</span><span class=p>(</span><span class=n>hex_data</span><span class=p>,</span> <span class=n>aes_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 获取数据包数量</span>
</span></span><span class=line><span class=cl>        <span class=n>packet_count</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>group</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>direction</span><span class=p>,</span> <span class=n>hex_data</span><span class=p>,</span> <span class=n>decrypted_data</span><span class=p>,</span> <span class=n>packet_count</span><span class=p>,</span> <span class=n>src_port</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 按方向和端口分组合并</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>successful_decrypts</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>failed_decrypts</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>direction_port</span><span class=p>,</span> <span class=n>group</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s2>&#34;方向端口&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>merge_tcp_direction</span><span class=p>(</span><span class=n>group</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>direction</span><span class=p>,</span> <span class=n>hex_data</span><span class=p>,</span> <span class=n>decrypted_data</span><span class=p>,</span> <span class=n>packet_count</span><span class=p>,</span> <span class=n>src_port</span> <span class=o>=</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 统计解密结果</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>decrypted_data</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=ow>and</span> <span class=n>decrypted_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>successful_decrypts</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;成功&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>failed_decrypts</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>status</span> <span class=o>=</span> <span class=s2>&#34;失败&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;方向: </span><span class=si>{</span><span class=n>direction_port</span><span class=si>}</span><span class=s2>, 数据包: </span><span class=si>{</span><span class=n>packet_count</span><span class=si>}</span><span class=s2>个, 解密: </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>direction_port</span><span class=p>,</span> <span class=n>hex_data</span><span class=p>,</span> <span class=n>decrypted_data</span><span class=p>,</span> <span class=n>src_port</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>解密统计: 成功 </span><span class=si>{</span><span class=n>successful_decrypts</span><span class=si>}</span><span class=s2> 个, 失败 </span><span class=si>{</span><span class=n>failed_decrypts</span><span class=si>}</span><span class=s2> 个&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_all_decrypted_data</span><span class=p>(</span><span class=n>results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>,</span> <span class=nb>int</span><span class=p>]],</span> <span class=n>output_dir</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;output&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;将每个流量的解密数据单独保存为ZIP文件&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 创建输出目录</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>output_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>saved_files</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>direction_port</span><span class=p>,</span> <span class=n>hex_data</span><span class=p>,</span> <span class=n>decrypted_data</span><span class=p>,</span> <span class=n>src_port</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>decrypted_data</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=ow>and</span> <span class=n>decrypted_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 简洁的文件名：只使用索引</span>
</span></span><span class=line><span class=cl>            <span class=n>filename</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;flow_</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2>.zip&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>filepath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>output_dir</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># 保存为ZIP文件</span>
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>decrypted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;保存文件: </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2>, 源端口: </span><span class=si>{</span><span class=n>src_port</span><span class=si>}</span><span class=s2>, 长度: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>decrypted_data</span><span class=p>)</span><span class=si>}</span><span class=s2> 字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>saved_files</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>filename</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>decrypted_data</span><span class=p>),</span> <span class=n>src_port</span><span class=p>,</span> <span class=n>direction_port</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>所有解密数据已保存到目录: </span><span class=si>{</span><span class=n>output_dir</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总共保存了 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>saved_files</span><span class=p>)</span><span class=si>}</span><span class=s2> 个ZIP文件&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 显示保存的文件统计</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>saved_files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 保存的文件列表 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>total_size</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>filename</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>src_port</span><span class=p>,</span> <span class=n>direction</span> <span class=ow>in</span> <span class=n>saved_files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2> - 端口: </span><span class=si>{</span><span class=n>src_port</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>size</span><span class=si>}</span><span class=s2> 字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    方向: </span><span class=si>{</span><span class=n>direction</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>total_size</span> <span class=o>+=</span> <span class=n>size</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总数据大小: </span><span class=si>{</span><span class=n>total_size</span><span class=si>}</span><span class=s2> 字节&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>saved_files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 配置参数</span>
</span></span><span class=line><span class=cl>    <span class=n>PCAP_FILE</span> <span class=o>=</span> <span class=s2>&#34;capture.pcapng&#34;</span>  <span class=c1># 你的PCAPNG文件路径</span>
</span></span><span class=line><span class=cl>    <span class=n>TARGET_IP1</span> <span class=o>=</span> <span class=s2>&#34;192.168.0.234&#34;</span>  <span class=c1># 目标IP1</span>
</span></span><span class=line><span class=cl>    <span class=n>TARGET_IP2</span> <span class=o>=</span> <span class=s2>&#34;120.232.61.180&#34;</span>  <span class=c1># 目标IP2</span>
</span></span><span class=line><span class=cl>    <span class=n>OUTPUT_FILE</span> <span class=o>=</span> <span class=s2>&#34;all_decrypted_data.bin&#34;</span>  <span class=c1># 输出文件路径</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 检查依赖</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;错误: 需要安装pycryptodome库&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;请运行: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 执行提取和AES解密</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;开始提取TCP通讯并进行AES-256-ECB解密...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=n>extract_tcp_communication</span><span class=p>(</span><span class=n>PCAP_FILE</span><span class=p>,</span> <span class=n>TARGET_IP1</span><span class=p>,</span> <span class=n>TARGET_IP2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 分析解密数据</span>
</span></span><span class=line><span class=cl><span class=c1>##        analyze_decrypted_data(results)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 保存所有解密数据到文件</span>
</span></span><span class=line><span class=cl><span class=c1>##        os.makedirs(&#34;output_zip_files&#34;, exist_ok=True)</span>
</span></span><span class=line><span class=cl>        <span class=n>saved_files</span> <span class=o>=</span> <span class=n>save_all_decrypted_data</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=s2>&#34;output_zip_files&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>=== 完成 ===&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;总共处理了 </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>results</span><span class=p>)</span><span class=si>}</span><span class=s2> 个通讯流&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;最终输出文件: </span><span class=si>{</span><span class=n>OUTPUT_FILE</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;未找到任何TCP通讯数据&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>爆破完后得到恢复的压缩包</p><p>批量做CRC</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>解密完成！总共解密了 <span class=m>319</span> 字节
</span></span><span class=line><span class=cl>解密数据十六进制: 53290000cbae0200cb2c000053310400d3320400d3320200d3320000d332060033d5020033b20400d332010033340600334d0400334f0300d3320000d332020033d3020033d0020033360500d33200003331040033d602004bb6000033360500b34806004bb504004b350300b3300500b348030033340300333307003335060033330600334f01004b350400333105004b3100004bb60000333104004b4e05004bb504004b4d03004b3107004b4e03003332000033b000004b310400334e050033350500334c01004b310500b33001004b320300b34c06004b4c050033b50000b33405004b3607004b490300333105004b330600334a03004b4903004b320500334c010033480600334801003332070033b600003332000033320600b3b40000b33403004b3106004b350300d3520100d32f0000cbae0200cb2c0000530100
</span></span></code></pre></td></tr></table></div></div><p>这一串数据得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$pkzip$1</span>*1*2*0*35*29*4135a7f*0*26*0*35*0413*c8358ce9e6858f166753637de145d0c841cee9efd7cf2008d13e551dd584b69cae5895c7df45f32fdfb51d0c0d273820239896d3e6*$/pkzip$
</span></span></code></pre></td></tr></table></div></div><p>使用之前明文攻击得到的密钥恢复</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>binascii</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cipher_hex</span> <span class=o>=</span> <span class=s2>&#34;c8358ce9e6858f166753637de145d0c841cee9efd7cf2008d13e551dd584b69cae5895c7df45f32fdfb51d0c0d273820239896d3e6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>cipher_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>key0</span> <span class=o>=</span> <span class=mh>0xb47e923c</span>
</span></span><span class=line><span class=cl><span class=n>key1</span> <span class=o>=</span> <span class=mh>0x5aeb49a7</span>
</span></span><span class=line><span class=cl><span class=n>key2</span> <span class=o>=</span> <span class=mh>0xa3cd7af0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>crctab</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=mh>0xEDB88320</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>crctab</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_keys</span><span class=p>(</span><span class=n>ch</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>key0</span><span class=p>,</span> <span class=n>key1</span><span class=p>,</span> <span class=n>key2</span>
</span></span><span class=line><span class=cl>    <span class=n>key0</span> <span class=o>=</span> <span class=n>crctab</span><span class=p>[(</span><span class=n>key0</span> <span class=o>^</span> <span class=n>ch</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>]</span> <span class=o>^</span> <span class=p>(</span><span class=n>key0</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>key1</span> <span class=o>=</span> <span class=p>(</span><span class=n>key1</span> <span class=o>+</span> <span class=p>(</span><span class=n>key0</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>key1</span> <span class=o>=</span> <span class=p>(</span><span class=n>key1</span> <span class=o>*</span> <span class=mi>134775813</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>    <span class=n>key2</span> <span class=o>=</span> <span class=n>crctab</span><span class=p>[(</span><span class=n>key2</span> <span class=o>^</span> <span class=p>(</span><span class=n>key1</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>]</span> <span class=o>^</span> <span class=p>(</span><span class=n>key2</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_byte</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=p>(</span><span class=n>key2</span> <span class=o>|</span> <span class=mi>3</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffff</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>((</span><span class=n>temp</span> <span class=o>*</span> <span class=p>(</span><span class=n>temp</span> <span class=o>^</span> <span class=mi>1</span><span class=p>))</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xff</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plain</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>k</span> <span class=o>=</span> <span class=n>decrypt_byte</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>c</span> <span class=o>^</span> <span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=n>plain</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>update_keys</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密明文（hex）:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>plain</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>解密明文:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=k>if</span> <span class=mi>32</span> <span class=o>&lt;=</span> <span class=n>b</span> <span class=o>&lt;=</span> <span class=mi>126</span> <span class=k>else</span> <span class=s1>&#39;.&#39;</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>plain</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div></section><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","Wh1teJ0ker/discussion"),s.setAttribute("data-repo-id","R_kgDOOTzcZA"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOOTzcZM4CoxXV"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","top"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div><div class=paginator><a class=prev href=https://wh1tej0ker.github.io/post/2025hitctf-zrsb8p.html><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>2025HITCTF</span></a>
<a class=next href=https://wh1tej0ker.github.io/post/2025rctf-2sxbu2.html><span>2025RCTF</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></div></div></article></div><footer class=footer><p>&copy; 2026 <a href=https://wh1tej0ker.github.io/>Wh1teJ0kerのBlog</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';function n(){t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout(()=>{t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>'},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main><div id=search-modal class=search-modal style=display:none><div class=search-modal-content><div class=search-input-wrapper><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input type=text id=search-input placeholder=搜索标题、标签或正文关键字 autocomplete=off>
<button type=button id=search-clear class=search-clear aria-label=清除搜索>
×
</button>
<span class=search-shortcut>ESC</span></div><div id=search-results class=search-results></div></div></div><style>#search-modal{position:fixed;inset:0;z-index:2000;display:none;background-color:rgba(15,23,42,.6);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);align-items:center;justify-content:center;padding:0 1.5rem}#search-modal.active{display:flex}#search-modal .search-modal-content{width:100%;max-width:880px;max-height:80vh;margin:0;background:0 0;box-shadow:none;border-radius:0;display:flex;flex-direction:column}[data-dark-mode] #search-modal .search-modal-content{background:0 0;border:none}</style></body><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.6.2></script><script src=/main.min.80d50982893555370f4aacc2affcf405ae67515c8053bb96ae4aa69934f4efec7c58bde5638ac91af85238507fcc283a42df3e061b5b83554fd71d3c87979053.js integrity="sha512-gNUJgok1VTcPSqzCr/z0Ba5nUVyAU7uWrkqmmTT07+x8WL3lY4rJGvhSOFB/zCg6Qt8+Bhtbg1VP1x08h5eQUw==" crossorigin=anonymous defer></script></html>