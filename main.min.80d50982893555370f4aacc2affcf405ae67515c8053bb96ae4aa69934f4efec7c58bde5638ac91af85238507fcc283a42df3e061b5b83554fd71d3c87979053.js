document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("search-btn"),s=document.getElementById("search-modal"),a=document.getElementById("search-close"),e=document.getElementById("search-input"),n=document.getElementById("search-results"),t=document.getElementById("search-clear");let o,c=[];async function d(){try{const e=await fetch("/index.json");c=await e.json();const t={keys:["title","tags","categories","content"],threshold:.3,ignoreLocation:!0,includeMatches:!0,minMatchCharLength:2};o=new Fuse(c,t)}catch(e){console.error("Error fetching search index:",e)}}r&&r.addEventListener("click",n=>{n.preventDefault(),s.style.display="flex",requestAnimationFrame(()=>{s.classList.add("active")}),o||d(),e&&(e.focus(),t&&t.classList.toggle("visible",e.value.trim().length>0)),document.body.style.overflow="hidden"}),a&&a.addEventListener("click",()=>{i()}),window.addEventListener("click",e=>{e.target===s&&i()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&(s.classList.contains("active")||s.style.display==="flex")&&i()});function i(){s.classList.remove("active"),setTimeout(()=>{s.style.display="none"},200),document.body.style.overflow="",e&&(e.value=""),n&&(n.innerHTML=""),t&&t.classList.remove("visible")}e&&e.addEventListener("input",e=>{if(t&&t.classList.toggle("visible",e.target.value.trim().length>0),!o)return;const s=e.target.value.trim();if(s.length===0){n&&(n.innerHTML="");return}const i=o.search(s);u(i)}),t&&e&&t.addEventListener("click",()=>{e.value="",e.focus(),n&&(n.innerHTML=""),t.classList.remove("visible")});function u(e){if(e.length===0){n.innerHTML='<div class="search-item">No results found</div>';return}const t=e.map(e=>{const t=e.item,a=new Date(t.date).toLocaleDateString();let s=t.title;const o=e.matches&&e.matches.find(e=>e.key==="title");o&&(s=l(t.title,o.indices));let i=t.content?t.content.substring(0,150)+"...":"";const n=e.matches&&e.matches.find(e=>e.key==="content");if(n&&t.content){const s=n.indices[0][0],e=Math.max(0,s-75),o=Math.min(t.content.length,s+75);i=(e>0?"...":"")+l(t.content.substring(e,o),h(n.indices,e))+(o<t.content.length?"...":"")}return`
                <div class="search-item">
                    <a href="${t.permalink}">
                        <div class="search-item-title">${s}</div>
                        <div class="search-item-meta">
                            <span>${a}</span>
                            ${t.tags?` Â· ${t.tags.join(", ")}`:""}
                        </div>
                        <div class="search-item-desc">
                            ${i}
                        </div>
                    </a>
                </div>
            `}).join("");n.innerHTML=t}function l(e,t){let n="",s=0;return t.forEach(t=>{if(t[0]>=e.length)return;const o=Math.min(t[1],e.length-1);n+=e.substring(s,t[0]),n+="<mark>"+e.substring(t[0],o+1)+"</mark>",s=o+1}),n+=e.substring(s),n}function h(e,t){return e.map(e=>[e[0]-t,e[1]-t]).filter(e=>e[0]>=0&&e[1]>=0)}})